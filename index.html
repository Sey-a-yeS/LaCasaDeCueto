<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>La Casa De Cueto — Book & Review</title>
  <meta name="description" content="La Casa De Cueto — family-run island stay in Panglao, Bohol. Book rooms, read guest reviews, and contact us."/>
  <meta name="keywords" content="La Casa De Cueto, Panglao, Bohol, guesthouse, hotel, booking, reviews" />
  <meta name="theme-color" content="#A89984" />
  <meta property="og:title" content="La Casa De Cueto — Book & Review"/>
  <meta property="og:description" content="Family-run island stay in Panglao, Bohol. Book rooms, read guest reviews, and contact us."/>
  <meta property="og:image" content="https://placehold.co/1200x630/B5A78B/FFFFFF?text=La+Casa+De+Cueto" />
  <!-- Structured data is generated dynamically from client-side reviews (see reviews-jsonld) -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Playfair+Display:wght@600;700;800&display=swap" as="style" onload="this.rel='stylesheet'">
  <!-- Favicon -->
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <!-- Performance notes: convert large images to WebP and minify CSS/JS in build process (see README or build script). Preload critical fonts above to reduce layout shifts. -->
  <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Playfair+Display:wght@600;700;800&display=swap" rel="stylesheet"></noscript>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" />
  <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />

  <style>

    :root{
      /* Spacing & type scale for consistent rhythm */
      --space-1: 4px;
      --space-2: 8px;
      --space-3: 12px;
      --space-4: 16px;
      --space-5: 24px;

      --fs-h1: 72px;
      --fs-h2: 52px;
      --fs-h3: 36px;
      --fs-body: 16px;

      --accent-color: #A89984; /* Main Earthy Taupe */
      --accent-dark: #8B7D6C; /* Darker Taupe/Brown for contrast */
      --accent-light: #F7F5F2; /* Very Light Off-White/Warm Gray */
      --primary-text: #333333;
      --page-bg: #FFFFFF;
      --bg-alternate: var(--accent-light);
      --teal-glow: #2ecc71;
      --gold-glow: #ffc107;

      --muted-text: #6f6f6f;
      --card-bg: #FFFFFF;
      --shadow-light: rgba(0,0,0,0.06);
      --shadow-strong: rgba(0,0,0,0.15); /* Slightly stronger shadow */
      --border-color: #E6E4E0;
      --star-color: #D4AF37; /* More luxurious gold for stars */
      --header-text: #FFFFFF;
      --section-separator: 8px solid var(--accent-dark);

      --max-width: 1200px;
      --radius-lg: 16px;
      --radius-md: 10px;
      --ease: cubic-bezier(.2,.9,.2,1);
    }

    /* Dark Mode Polish */
    body.dark-mode {
      --page-bg: #0f0f10;
      --card-bg: #1c1c1e;
      --primary-text: #EBEBEB;
      --muted-text: #bdbdbd;
      --accent-light: #2b2b2b;
      --border-color: #2f2f2f;
      --accent-color: #B59F67; /* Brighter accent in dark mode */
      --accent-dark: #A08B5C;
      --star-color: #FFD700; /* Pure gold in dark mode */
      color: var(--primary-text);
      /* Add a subtle texture gradient for depth */
      background: linear-gradient(180deg, var(--page-bg) 0%, rgba(30, 30, 32, 0.8) 100%);
    }

    * { box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      margin: 0;
      font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color: var(--primary-text);
      /* Enhanced subtle background gradient for texture */
      background: linear-gradient(180deg, var(--page-bg) 0%, rgba(251,249,247,0.7) 100%);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      line-height: 1.6;
      transition: background .35s ease, color .35s ease;
      min-height: 100%;
    }

    /* Accessible Skip link */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 12px;
      background: var(--accent-dark);
      color: var(--header-text);
      padding: 8px 10px;
      border-radius: 8px;
      z-index: 200;
      transition: top .18s;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    .skip-link:focus { top: 12px; }

    /* Layout helpers */
    .wrap {
      max-width: var(--max-width);
      margin: 0 auto;
      padding: 0 22px;
    }
    .view {
      padding: 80px 0;
      /* Remove top border, rely on section separator and card shadows */
      background: var(--page-bg);
      /* border-top: 1px solid var(--border-color); */
    }

    /* Header */
    .site-header{
      position: sticky;
      top: 0;
      z-index: 60;
      /* Refined gradient and opacity for a more polished glass effect */
      background: linear-gradient(90deg, rgba(139,125,108,0.98), rgba(168,153,132,0.98));
      padding: 14px 22px; /* Slight increase in padding */
      backdrop-filter: blur(8px); /* Stronger blur */
      box-shadow: 0 4px 20px rgba(0,0,0,0.25); /* More noticeable shadow */
      border-bottom: 1px solid rgba(255,255,255,0.15); /* More visible bottom border */
    }
    .header-inner{
      max-width: var(--max-width);
      margin: 0 auto;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 18px;
    }
    .brand{
      display:flex;
      gap:12px;
      align-items:center;
      cursor:pointer;
      text-decoration:none;
      color:var(--header-text);
    }
    .brand-logo{
      width:48px;height:48px;border-radius:10px;
      display:flex;align-items:center;justify-content:center;
      /* Enhanced logo background for depth */
      background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.05));
      color: white; font-weight:800; font-family: 'Playfair Display', serif;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.12);
    }
    .brand-main{ font-family: 'Playfair Display', serif; font-size:20px; color:var(--header-text); line-height:1; font-weight:800; }
    .brand-accent{ font-size:10px; color: rgba(255,255,255,0.9); letter-spacing:2px; text-transform:uppercase; font-weight: 500;}

    .nav-and-toggle { display:flex; align-items:center; gap:14px; }

    .nav {
      display:flex; gap:6px; align-items:center; /* Tighter gap */
    }
    .nav a {
      color: rgba(255,255,255,0.95);
      text-decoration:none; padding:10px 14px; border-radius:12px; /* Larger hit area, rounder corners */
      font-weight:700; font-size:13px; letter-spacing:0.5px; text-transform:uppercase;
      transition: all .2s var(--ease);
    }
    .nav a:hover { transform: translateY(-1px); background: rgba(255,255,255,0.12); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    .nav a.active { background: rgba(255,255,255,0.2); box-shadow: 0 3px 10px rgba(0,0,0,0.12); transform: none; }

    #dark-mode-toggle {
      background: rgba(255,255,255,0.06); /* Solid background for contrast */
      border: 1px solid rgba(255,255,255,0.15);
      color: var(--header-text); padding:10px; border-radius:12px; cursor:pointer;
      display:flex; align-items:center; gap:8px; font-size:16px;
      transition: transform .18s, background .18s, box-shadow .18s;
    }

    /* Mobile hamburger and mobile nav */
    .mobile-menu-button {
      display:none; background: rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.12); color:var(--header-text); padding:10px 12px; border-radius:12px; cursor:pointer;
    }
    .mobile-nav-overlay {
      position: fixed; inset: 0 0 0 0; z-index: 1000; display:none; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); align-items:flex-start; justify-content:center; padding-top:80px;
    }
    /* Animated mobile overlay */
    .mobile-nav-overlay { opacity:0; visibility:hidden; transition: opacity .28s ease, visibility .28s; }
    .mobile-nav-overlay.show { display:flex; opacity:1; visibility:visible; }
    .mobile-nav-panel { width:100%; max-width:420px; background:var(--card-bg); border-radius:12px; padding:18px; box-shadow:0 20px 60px rgba(0,0,0,0.25); transform: translateY(-8px); transition: transform .28s var(--ease); }
    .mobile-nav-overlay.show .mobile-nav-panel { transform: translateY(0); }
    .mobile-nav-panel a { display:block; padding:12px 10px; border-radius:10px; color:var(--primary-text); text-decoration:none; font-weight:700; }

    /* Bottom navigation for mobile */
    .mobile-bottom-nav { display:none; position:fixed; left:50%; transform:translateX(-50%); bottom:12px; z-index:90; width:95%; max-width:480px; background:var(--card-bg); border-radius:999px; padding:8px 12px; box-shadow:0 12px 40px rgba(0,0,0,0.18); display:flex; gap:8px; justify-content:space-around; align-items:center; }
    .mobile-bottom-nav button { background:transparent; border:none; color:var(--muted-text); display:flex; flex-direction:column; align-items:center; gap:4px; font-size:12px; cursor:pointer; }
    .mobile-bottom-nav button.active { color:var(--accent-dark); font-weight:800; }

    /* Back to top */
    #backToTop { 
      position:fixed; 
      right:30px; 
      bottom:120px; /* Move higher up */
      z-index:95; 
      display:none; 
      background:var(--accent-dark); 
      color:white; 
      width: 45px;
      height: 45px;
      display: none;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      border-radius: 50%; 
      box-shadow: 0 8px 30px rgba(0,0,0,0.25); 
      cursor:pointer;
      transition: transform .2s, background-color .2s;
    }
    #backToTop:hover {
      transform: translateY(-4px);
      background: var(--accent-color);
    }
    @media (max-width: 768px) {
      #backToTop {
        right: auto;
        left: 20px;
        bottom: 100px;
      }
    }

    /* Floating widget collapsed state (mobile) */
    .floating-booking-widget .collapse-toggle { display:none; background:transparent; border:none; color:white; font-size:18px; cursor:pointer; }
    .floating-booking-widget.collapsed { width:56px; padding:10px; overflow:hidden; }
    .floating-booking-widget.collapsed input, .floating-booking-widget.collapsed .form-control-group { display:none; }
    .floating-booking-widget.collapsed .collapse-toggle { display:block; }
    #dark-mode-toggle:hover { transform: scale(1.0); background: rgba(255,255,255,0.12); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    #dark-mode-toggle:active { transform: scale(0.98); }

    /* HERO */
    .hero {
      padding: 130px 22px; /* More vertical space */
      position: relative;
      /* Remove bottom border, use shadow and radius */
      overflow: hidden;
      background: linear-gradient(180deg, rgba(245,241,236,0.7), rgba(251,249,247,0.6)), url('https://placehold.co/1600x700/B5A78B/FFFFFF?text=Stunning+Bohol+View') center/cover no-repeat;
      display:flex; align-items:center; justify-content:center;
      box-shadow: 0 12px 50px rgba(0,0,0,0.15); /* Deeper shadow */
      border-radius: 0 0 40px 40px; /* More pronounced radius */
    }
  /* Hero media (video) — positioned beneath content; fallback uses existing background image */
  .hero-media { position:absolute; inset:0; z-index:1; pointer-events:none; overflow:hidden; border-radius: 0 0 40px 40px; }
  .hero-media video { width:100%; height:100%; object-fit:cover; display:block; transform:translateZ(0); }
  .hero .hero-content { position:relative; z-index:10; }

  /* Slight parallax effect: we'll translate the content on scroll */
  .hero-parallax { transition: transform .15s linear; will-change: transform; }
    .hero::before{
      content: "";
      position:absolute; inset:0;
      /* Subtler blend mode for background image effect */
      background: linear-gradient(180deg, rgba(255,255,255,0.2), rgba(255,255,255,0.08));
      mix-blend-mode: soft-light;
    }
    .hero .hero-content{ position:relative; z-index:10; max-width:1020px; text-align:center; padding: 0 12px; }

    .headline {
      font-family: 'Playfair Display', serif;
      font-size: 72px; /* Larger headline */
      margin:0; line-height:1.1; color:var(--primary-text);
      text-shadow: 0 6px 20px rgba(168,153,132,0.2); /* Softened text shadow */
      letter-spacing:-1.5px;
      font-weight: 800;
    }
    .subheadline { font-size:22px; margin:20px 0 30px; color:var(--muted-text); font-weight:400; max-width: 680px; margin-left: auto; margin-right: auto; }

    .cta-row { display:flex; gap:16px; justify-content:center; flex-wrap:wrap; }

    .btn {
      border:none; cursor:pointer; border-radius:14px; /* Rounder buttons */
      padding:14px 22px; /* Larger button size */
      font-weight:700;
      font-size:15px; text-transform:uppercase; letter-spacing:1px; display:inline-flex;
      align-items:center; gap:10px; transition: transform .25s var(--ease), box-shadow .25s, opacity .25s;
    }
  /* Micro-animation helpers */
  .img-zoom { transition: transform .6s var(--ease); will-change: transform; }
  .img-zoom:hover { transform: scale(1.06); }
  .fade-in { opacity: 0; transform: translateY(8px); transition: opacity .5s ease, transform .5s ease; }
  .fade-in.show { opacity: 1; transform: translateY(0); }

  /* Skeleton loader */
  .skeleton { background: linear-gradient(90deg, #eee, #f5f5f5, #eee); background-size:200% 100%; animation: shimmer 1.2s linear infinite; border-radius:12px; }
  @keyframes shimmer { 0% { background-position:200% 0; } 100% { background-position:-200% 0; } }
  .skeleton.text { height:14px; margin-bottom:8px; }
  .skeleton.img { height:220px; width:100%; display:block; }

  /* Toast/snackbar */
  .toast-container { position: fixed; right: 18px; bottom: 18px; z-index: 1300; display:flex; flex-direction:column; gap:10px; }
  .toast { background: #111; color: #fff; padding:10px 14px; border-radius:10px; box-shadow: 0 8px 30px rgba(0,0,0,0.3); opacity:0; transform: translateY(8px); transition: opacity .25s, transform .25s; }
  .toast.show { opacity:1; transform: translateY(0); }
  .toast.info { background: #333; }
  .toast.success { background: #2ecc71; }
  .toast.error { background: #e74c3c; }
    .btn.primary {
      background: linear-gradient(135deg, var(--accent-dark), var(--accent-color)); /* More appealing angle */
      color: white;
      box-shadow: 0 8px 30px rgba(139,125,108,0.25); /* Deeper shadow */
    }
    .btn.primary:hover {
        transform: translateY(-4px);
        box-shadow: 0 18px 40px rgba(139,125,108,0.35); /* Much deeper shadow on hover */
        opacity: 0.95;
    }
    .btn.google-btn {
      background: var(--card-bg); color: var(--primary-text);
      border: 1px solid var(--border-color);
      padding:12px 18px; border-radius:14px;
      font-weight:700;
      box-shadow: 0 4px 12px var(--shadow-light);
    }
    .btn.google-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px var(--shadow-strong);
        border-color: var(--accent-color);
    }

    /* spinner for buttons */
    .btn .spinner { display:inline-block; width:16px; height:16px; border:2px solid rgba(255,255,255,0.3); border-top-color:rgba(255,255,255,0.9); border-radius:50%; animation: spin .8s linear infinite; margin-left:8px; vertical-align:middle; }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* SECTION TITLES */
    .section-title {
      font-family: 'Playfair Display', serif; font-size:52px; margin:0 0 10px; text-align:center;
      color: var(--primary-text);
      font-weight: 800;
    }
    .section-subtitle { text-align:center; color:var(--muted-text); margin:0 auto 50px; max-width:820px; font-size:17px; }

    /* cards / feature blocks */
    .card {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      padding: 22px; /* Slight increase in padding */
      box-shadow: 0 10px 30px var(--shadow-light); /* Softer initial shadow */
      border: 1px solid var(--border-color);
      transition: transform .25s var(--ease), box-shadow .25s;
    }
    .card:hover { transform: translateY(-4px); box-shadow: 0 18px 55px var(--shadow-strong); } /* More dynamic lift */

    .features-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px; margin-top: 25px; } /* Larger blocks, more gap */
    .feature-block { text-align:center; padding:30px; border-radius: 14px; background: var(--card-bg); box-shadow: 0 4px 12px rgba(0,0,0,0.04); }
    .feature-block i {
        font-size:3.2rem; /* Larger icon */
        color:var(--accent-dark);
        margin-bottom:15px;
        transition: color .2s;
    }
    .feature-block:hover i { color: var(--accent-color); }
    .feature-block strong { display:block; font-size:1.2rem; margin-bottom:6px; color:var(--primary-text); font-weight: 700; }
    .feature-block p { margin-bottom: 0; }

    /* Room gallery (swiper) */
    .room-gallery-container {
        max-width:1020px;
        margin:40px auto;
        padding:20px;
        border-radius:20px;
        display:block;
        background: var(--bg-alternate); /* Highlight the gallery area */
        box-shadow: inset 0 0 15px rgba(0,0,0,0.05);
    }
    .swiper { width:100%; height:100%; }
    .swiper-slide img { width:100%; height:500px; object-fit:cover; border-radius:16px; display:block; box-shadow: 0 6px 20px rgba(0,0,0,0.1); }
    .room-gallery-thumbs .swiper-slide { height:120px; opacity:0.6; border-radius:10px; overflow:hidden; transition: opacity .2s; }
    .room-gallery-thumbs .swiper-slide-thumb-active { opacity: 1; border: 2px solid var(--accent-dark); }

    /* room cards */
    .room-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(340px, 1fr)); gap:35px; margin-top:25px; } /* More gap */
    .room-card { overflow:hidden; border-radius:18px; /* Rounder card */ display:flex; flex-direction:column; cursor:pointer; padding:0; border:1px solid var(--border-color); box-shadow: 0 10px 30px var(--shadow-light); }
    .room-card img { width:100%; height:280px; /* Taller image */ object-fit:cover; transition: transform .8s var(--ease); display:block; }
    .room-card:hover img { transform: scale(1.08); } /* More dramatic zoom */
    .room-details { padding:22px; display:flex; flex-direction:column; gap:12px; background: var(--card-bg); }
    .room-details h3 { margin:0; font-size:24px; font-family: 'Playfair Display', serif; color:var(--primary-text); font-weight: 700; }

    .amenities-list { display:grid; grid-template-columns: repeat(2,1fr); gap:10px 15px; list-style:none; padding:0; margin:15px 0 0; font-size:14px; border-top:2px solid var(--accent-light); padding-top:12px; } /* Solid separator */
    .amenities-list li { display:flex; align-items:center; gap:8px; color:var(--muted-text); }
    .amenities-list li i { color: var(--accent-color); }

    /* booking summary */
    .two-col { display:grid; gap:35px; } /* More gap */
    @media(min-width:769px) { .two-col { grid-template-columns: 3fr 1.5fr; align-items:start; } }

    .booking-summary {
        position: sticky;
        top:110px;
        padding: 20px;
        border-radius: 18px;
        background: var(--bg-alternate); /* Highlight summary box */
        box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    }

    .room-carousel-card { 
      position: relative; 
      height: 300px; 
      border-radius: 16px; 
      overflow: hidden;
      background: var(--accent-light);
    }
    .carousel-slide-container {
      position: relative;
      width: 100%;
      height: 100%;
    }
    .carousel-image { 
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
      pointer-events: none;
    }
    .carousel-image.active { 
      opacity: 1;
      z-index: 1;
    }

    .carousel-indicators { position:absolute; bottom:15px; left:50%; transform:translateX(-50%); display:flex; gap:10px; z-index:12; }
    .carousel-indicator { width:12px;height:12px;border-radius:50%; background: rgba(255,255,255,0.75); border: 2px solid rgba(0,0,0,0.1); cursor:pointer; transition: transform .2s, background .2s; }
    .carousel-indicator.active { background: var(--accent-dark); transform: scale(1.3); }

    /* forms */
    .form-card { padding:28px; } /* More padding */
    .form-group { margin-bottom:18px; }
    .form-group label { display:block; margin-bottom:8px; font-weight:700; color:var(--primary-text); font-size:14px; }
    input[type="text"], input[type="email"], input[type="date"], input[type="password"], input[type="number"], textarea, select {
      width:100%; padding:14px; border-radius:10px; /* Larger input, rounder corners */
      border:1px solid var(--border-color); background:var(--card-bg); font-size:16px;
      transition: box-shadow .18s, border-color .18s, background .18s, color .18s;
    }
    input:focus, textarea:focus { outline:none; box-shadow: 0 0 0 3px rgba(168,153,132,0.22); border-color:var(--accent-dark); }

    /* Validation states */
    .valid { border-color: #2ecc71 !important; box-shadow: 0 4px 12px rgba(46,204,113,0.12); }
    .invalid { border-color: #e74c3c !important; box-shadow: 0 4px 12px rgba(231,76,60,0.08); }
    .field-error { color: #e74c3c; font-size:0.9em; margin-top:6px; display:none; }
    .field-success { color: #2ecc71; font-size:0.9em; margin-top:6px; display:none; }

    /* Smooth theme transitions */
    :root, body, .card, .nav a { transition: background-color .25s var(--ease), color .25s var(--ease), border-color .25s var(--ease); }

    .muted-input { background: var(--accent-light); color:var(--muted-text); }
    .disclaimer { font-size:0.95em; color:var(--accent-dark); background:var(--accent-light); padding:12px; border-radius:10px; margin-top:15px; border-left:4px solid var(--accent-color); }

    /* reviews */
    .reviews-swiper .swiper-slide {
        background: var(--card-bg);
        border-radius: 16px;
        padding:25px; /* More padding */
        box-shadow: 0 4px 12px rgba(0,0,0,0.06);
        border-left: 6px solid var(--accent-color); /* Lighter accent line */
    }
    .review-title { font-family: 'Playfair Display', serif; font-size:20px; color:var(--primary-text); margin:0 0 8px; font-weight: 700; }
    .reviewer-info { font-size:0.95em; color:var(--muted-text); display:flex; align-items:center; gap:10px; }
    .avatar { width:40px;height:40px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;background:var(--accent-dark); color:white;font-weight:800; font-size: 1.1rem;}

    /* rating widget - HORIZONTAL layout (row) */
    .rating {
      display:flex;
      flex-direction: row-reverse;
      justify-content:center;
      gap:10px; /* More space */
      margin-bottom: 15px;
      align-items: center;
    }
    .rating > input { display: none; }
    .rating > label {
      cursor: pointer;
      font-size: 1.8rem; /* Larger stars */
      color: var(--border-color);
      transition: color .2s;
      display:inline-flex;
      line-height:1;
      user-select:none;
    }
    .rating > input:checked ~ label,
    .rating > input:checked ~ label ~ label { color: var(--star-color); }
    .rating > label:hover,
    .rating > label:hover ~ label { color: var(--star-color); }


    /* LOGIN SECTION (updated layout) */
    .auth-section {
      display: grid;
      grid-template-columns: minmax(280px, 1fr) 350px; /* Wider right column for form */
      gap: 30px; /* More space */
      align-items: stretch; /* Stretch items to match height */
      background: var(--bg-alternate); /* Consistent background */
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 15px 45px rgba(0,0,0,0.1);
      border: 1px solid var(--border-color);
    }
    .auth-left {
        padding-right: 15px;
        border-right: 1px dashed var(--border-color); /* Visual separation */
    }
    .auth-left .welcome-row { display:flex; justify-content:space-between; align-items:flex-start; gap:15px; } /* Align to start */
    .auth-left h3 { margin:0 0 8px 0; font-family:'Playfair Display', serif; font-size:24px; font-weight: 800; }
    .auth-left .small-note { margin:0; color:var(--muted-text); font-size:0.95rem; line-height: 1.5; }

    .auth-actions { display:flex; gap:12px; flex-wrap:wrap; margin-top:20px; }
    .social-btn {
      display:inline-flex; align-items:center; gap:10px; padding:12px 15px; border-radius:12px; font-weight:700; border:1px solid var(--border-color);
      background: var(--card-bg); cursor:pointer; transition: box-shadow .2s;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    .social-btn:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    .social-google { color:#333; }
    .social-facebook { color:#1877F2; }

    .auth-right { display:flex; align-items:center; }
    #loginSectionForm { width:100%; margin:0; padding: 0; background: none; border: none; box-shadow: none; }
    #loginSectionForm .form-group { margin-bottom:14px; }

    #accountSummary {
      display:flex;
      flex-direction:column;
      gap:12px;
      margin-top:20px;
      padding:15px;
      border-radius:12px;
      background:var(--card-bg);
      border:2px solid var(--accent-dark); /* Stronger border for logged-in state */
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    /* modal (centered and larger) */
    .modal {
      position: fixed;
      inset: 0;
      z-index: 1200;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 18px;
      transition: opacity .3s, backdrop-filter .3s;
    }
    .modal.show { display:flex; opacity:1; backdrop-filter: blur(4px); }
    .modal-card {
      width: 100%;
      max-width: 580px; /* slightly smaller modal */
      border-radius: 18px; /* rounder */
      padding: 30px; /* more padding */
      background: var(--card-bg);
      box-shadow: 0 20px 80px rgba(0,0,0,0.35); /* deeper shadow */
      border: 1px solid var(--border-color);
      transform: translateY(0);
      transition: transform .3s var(--ease);
      max-height: 90vh; /* allow scrolling inside modal on mobile */
      overflow: auto;
    }
    .modal:not(.show) .modal-card { transform: translateY(-20px); }
    .modal-close {
      position: absolute;
      right: 18px;
      top: 18px;
      background: var(--accent-light);
      border: none;
      color: var(--muted-text);
      font-size: 1.3rem; /* larger button */
      cursor: pointer;
      width: 40px; height: 40px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      transition: background .2s, color .2s;
    }
    .modal-close:hover {
        background: var(--border-color);
        color: var(--primary-text);
    }


    /* contact section polish */
    .contact-info-block {
        border-left: 5px solid var(--accent-dark);
        padding: 20px;
        transition: background .3s;
        border-radius: var(--radius-md);
    }
    .contact-info-block:hover {
        background: var(--accent-light);
    }
    .contact-info-block h4 {
        font-family: 'Playfair Display', serif;
        font-size: 20px;
        color: var(--accent-dark);
    }

    /* footer */
    .site-footer {
      padding:50px 12px;
      text-align:center;
      color:#fff;
      background: linear-gradient(135deg, var(--accent-dark), var(--accent-color));
      margin-top:50px;
      border-top: none; /* Removed redundant top border */
    }
    .footer-links a {
        color: rgba(255,255,255,0.95);
        margin:0 12px;
        font-size:18px;
        transition: color .2s, transform .2s;
    }
    .footer-links a:hover {
        color: var(--gold-glow);
        transform: scale(1.1);
    }

    /* floating booking widget */
    .floating-booking-widget {
      position: fixed; bottom: 30px; right: 30px; z-index:80;
      background: var(--accent-dark); padding:15px; border-radius:15px; display:flex; align-items:center; gap:15px;
      box-shadow: 0 15px 45px rgba(0,0,0,0.4);
      transform: translateX(30px); opacity:0; pointer-events:none; transition: transform .4s, opacity .4s;
      border:2px solid rgba(255,255,255,0.15);
    }
    .floating-booking-widget.show { transform: translateX(0); opacity:1; pointer-events:auto; }
    .floating-booking-widget label { color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.2); }
    .floating-booking-widget input {
        border:none;
        border-radius:10px;
        padding:10px 12px;
        width:120px;
        background:var(--card-bg);
        color:var(--primary-text);
        font-size: 14px;
        border: 1px solid var(--border-color);
    }
    body.dark-mode .floating-booking-widget input {
        background: var(--page-bg);
        border-color: var(--accent-light);
        color: white;
    }
    .floating-booking-widget .btn.primary {
        padding: 10px 15px;
        border-radius: 10px;
        font-size: 13px;
        box-shadow: none;
    }
    .floating-booking-widget .btn.primary:hover {
        transform: translateY(-2px);
    }


    @media (max-width:1024px) {
      .auth-section { grid-template-columns: 1fr; gap:20px; padding:20px; }
      .auth-left { border-right: none; padding-right: 0; padding-bottom: 20px; border-bottom: 1px dashed var(--border-color); }
      .auth-right { align-items:stretch; }
      .headline { font-size: 56px; }
    }
    @media (max-width:768px) {
      .headline { font-size:var(--fs-h3); }
      .section-title { font-size: 36px; }
      .room-grid { grid-template-columns: 1fr; }
      .room-card img { height:220px; }
      .wrap { padding:0 18px; }
      .view { padding: 50px 0; }
      .floating-booking-widget { left:50%; right:auto; transform: translate(-50%, 30px); width:95%; max-width: 420px; justify-content: space-between; padding: 12px; gap: 10px; }
      .floating-booking-widget .form-control-group { flex-grow: 1; }
      .floating-booking-widget input { width: 100%; }
      .floating-booking-widget .btn { flex-shrink: 0; }
      .room-gallery-thumbs { display:none; }
      .hero { padding: 70px 18px; border-radius: 0 0 25px 25px; }
      .nav { display: none; } /* Hide main nav on small screen */
      .mobile-menu-button { display:inline-flex; }
      .mobile-bottom-nav { display:flex; }
      .floating-booking-widget .collapse-toggle { display:block; }
    }

    /* small helpers */
    .muted { color: var(--muted-text); }
    .accent { color: var(--accent-color); }
    .hidden { display:none !important; }

  </style>
</head>
<body>

  <a class="skip-link" href="#main-content">Skip to content</a>

  <header class="site-header" role="banner">
    <div class="header-inner wrap">
      <div class="brand" onclick="showView('home')" role="button" aria-label="Go to home">
        <div class="brand-logo" aria-hidden="true">L</div>
        <div>
          <div class="brand-main">La Casa</div>
          <div class="brand-accent">De Cueto</div>
        </div>
      </div>

      <div class="nav-and-toggle" role="navigation" aria-label="Main">
        <nav class="nav" id="main-nav" aria-label="Main navigation">
          <a href="#home" class="nav-link" data-view="home" onclick="showView('home')">Home</a>
          <a href="#rooms" class="nav-link" data-view="rooms" onclick="showView('rooms')">Rooms</a>
          <a href="#booking" class="nav-link" data-view="booking" onclick="showView('booking')">Booking</a>
          <a href="#reviews" class="nav-link" data-view="reviews" onclick="showView('reviews')">Reviews</a>
          <a href="#contact" class="nav-link" data-view="contact" onclick="showView('contact')">Contact</a>
          <a href="#story" class="nav-link" data-view="story" onclick="showView('story')">Our Story</a>
          <a href="#login" class="nav-link" data-view="login" id="login-nav-link" onclick="showView('login')">Login</a>
        </nav>
        <button id="mobileMenuButton" class="mobile-menu-button" aria-label="Open menu" aria-expanded="false" onclick="toggleMobileMenu()"><i class="fas fa-bars"></i></button>
        <button id="dark-mode-toggle" aria-pressed="false" aria-label="Toggle dark mode" onclick="toggleDarkMode()">
          <i class="fas fa-moon"></i>
        </button>
      </div>
    </div>
  </header>

  <div id="mobileNavOverlay" class="mobile-nav-overlay" aria-hidden="true">
    <div class="mobile-nav-panel" role="dialog" aria-label="Mobile menu">
      <button style="float:right; border:none; background:transparent; font-size:18px;" aria-label="Close menu" onclick="toggleMobileMenu(false)">&times;</button>
      <nav style="margin-top:6px;">
        <a href="#home" onclick="toggleMobileMenu(false); showView('home')">Home</a>
        <a href="#rooms" onclick="toggleMobileMenu(false); showView('rooms')">Rooms</a>
        <a href="#booking" onclick="toggleMobileMenu(false); showView('booking')">Booking</a>
        <a href="#reviews" onclick="toggleMobileMenu(false); showView('reviews')">Reviews</a>
        <a href="#contact" onclick="toggleMobileMenu(false); showView('contact')">Contact</a>
        <a href="#story" onclick="toggleMobileMenu(false); showView('story')">Our Story</a>
        <a href="#login" onclick="toggleMobileMenu(false); showView('login')">Login</a>
      </nav>
    </div>
  </div>

  <main id="main-content">
    <section id="home" class="view" style="padding: 0 0 100px 0; border-top: none;">
      <div class="hero">
        <!-- Optional video background (keeps existing background image as poster/fallback).
             To use a real video, place `hero.mp4` in the same folder or update the src below to a CDN-hosted mp4.
             Video will be auto-played only on non-mobile and when network conditions allow. -->
        <div class="hero-media" aria-hidden="true">
          <video id="heroVideo" muted playsinline loop poster="https://placehold.co/1600x700/B5A78B/FFFFFF?text=Stunning+Bohol+View">
            <source src="hero.mp4" type="video/mp4">
            <!-- If you want to use a hosted sample video, replace the src above. If no video is available, the background image remains. -->
          </video>
        </div>
        <div class="hero-content wrap hero-parallax" data-aos="fade-up">
          <h1 class="headline">Escape to Tranquility in Panglao, Bohol</h1>
          <p class="subheadline">Experience the authentic charm and comfort of La Casa De Cueto, your ideal island getaway.</p>
          <div class="cta-row">
            <button class="btn primary cta-btn" onclick="showView('rooms')">Book Your Dream Stay Now</button>
            <button class="btn google-btn" onclick="showView('contact')"><i class="fas fa-info-circle"></i> Learn More</button>
          </div>
        </div>
      </div>

      <div class="wrap" data-aos="fade-up" data-aos-delay="120">
        <h2 class="section-title">Your Perfect Island Retreat</h2>
        <p class="section-subtitle">We blend warm Filipino hospitality with modern comfort—minutes from Alona Beach. Discover our commitment to your perfect stay.</p>

        <div class="features-grid" aria-hidden="false">
          <div class="feature-block" data-aos="zoom-in" data-aos-delay="200">
            <i class="fas fa-bed"></i>
            <strong>Comfort & Style</strong>
            <p class="muted">Premium bedding and decor.</p>
          </div>
          <div class="feature-block" data-aos="zoom-in" data-aos-delay="300">
            <i class="fas fa-wifi"></i>
            <strong>Free Wi‑Fi</strong>
            <p class="muted">Stay connected effortlessly.</p>
          </div>
          <div class="feature-block" data-aos="zoom-in" data-aos-delay="400">
            <i class="fas fa-mug-hot"></i>
            <strong>Free Breakfast</strong>
            <p class="muted">Enjoy a flawless, clean stay.</p>
          </div>
          <div class="feature-block" data-aos="zoom-in" data-aos-delay="500">
            <i class="fas fa-car-side"></i>
            <strong>Airport Transfer</strong>
            <p class="muted">Convenient pickup service.</p>
          </div>
        </div>

        <div style="text-align:center; margin-top:40px;" data-aos="fade-up" data-aos-delay="600">
          <a href="#story" class="btn google-btn" onclick="showView('story')"><i class="fas fa-book"></i> Read Our Story</a>
        </div>
      </div>
    </section>

    <section id="rooms" class="view">
      <div class="wrap">
        <h2 class="section-title" data-aos="fade-up">Our Exclusive Rooms</h2>
        <p class="section-subtitle" data-aos="fade-up" data-aos-delay="100">We offer two intimate rooms for a quiet and comfortable stay, each at ₱2,500/night. Click to view and book!</p>

        <div class="room-gallery-container" data-aos="fade-up" data-aos-delay="200" aria-hidden="false">
          <div class="swiper room-gallery-top">
            <div class="swiper-wrapper" id="room-gallery-main-slides"></div>
          </div>

          <div class="swiper room-gallery-thumbs" style="margin-top:12px;">
            <div class="swiper-wrapper" id="room-gallery-thumb-slides"></div>
          </div>
        </div>

        <div class="room-grid" data-aos="fade-up" data-aos-delay="300">
          <div class="room-card card" data-room-code="room1" onclick="selectRoom('room1'); (typeof openCalendarForRoom === 'function' ? openCalendarForRoom('room1') : showView('booking'))" role="button" aria-label="Select Room 1">
            <img src="https://placehold.co/800x600/B5A78B/FFFFFF?text=Room+1+Twin+Beds" alt="Photo of Room 1" loading="lazy">
            <div class="room-details">
              <h3>Room 1 (Twin Beds)</h3>
              <p class="muted">A cozy, well-appointed room featuring a comfortable queen-sized bed and modern amenities for a perfect stay.</p>
              <ul class="amenities-list">
                <li><i class="fas fa-bed"></i> Twin Beds (x2)</li>
                <li><i class="fas fa-door-open"></i> Private Bathroom</li>
                <li><i class="fas fa-tv"></i> Smart TV</li>
                <li><i class="fas fa-snowflake"></i> Air Conditioning</li>
              </ul>
              <div style="margin-top:10px; display:flex; justify-content:space-between; align-items:center;">
                <span style="font-size:1.25em; font-weight:700; color:var(--accent-dark);">₱2,500<small style="font-weight:400; font-size:0.6em; color:var(--muted-text);">/night</small></span>
                <button class="btn primary" style="pointer-events:none;">Book Now</button>
              </div>
            </div>
          </div>

          <div class="room-card card" data-room-code="room2" onclick="selectRoom('room2'); (typeof openCalendarForRoom === 'function' ? openCalendarForRoom('room2') : showView('booking'))" role="button" aria-label="Select Room 2">
            <img src="https://placehold.co/800x600/9E917A/FFFFFF?text=Room+2+Twin+Beds" alt="Photo of Room 2" loading="lazy">
            <div class="room-details">
              <h3>Room 2 (Twin Beds)</h3>
              <p class="muted">Ideal for friends or family, this room offers two single twin beds and a small private balcony for relaxing.</p>
              <ul class="amenities-list">
                <li><i class="fas fa-bed"></i> Twin Beds (x2)</li>
                <li><i class="fas fa-door-open"></i> Private Bathroom</li>
                <li><i class="fas fa-tv"></i> Smart TV</li>
                <li><i class="fas fa-snowflake"></i> Air Conditioning</li>
              </ul>
              <div style="margin-top:10px; display:flex; justify-content:space-between; align-items:center;">
                <span style="font-size:1.25em; font-weight:700; color:var(--accent-dark);">₱2,500<small style="font-weight:400; font-size:0.6em; color:var(--muted-text);">/night</small></span>
                <button class="btn primary" style="pointer-events:none;">Book Now</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="booking" class="view">
      <div class="wrap">
        <div class="two-col">
          <div data-aos="fade-right">
            <h2 style="font-size:38px; margin:0 0 8px; font-family: 'Playfair Display', serif;">Confirm Your Reservation</h2>
            <p style="margin:0 0 20px; color:var(--muted-text)">You are reserving <strong class="accent" id="selected-room">Room 1 (Queen Bed)</strong>.</p>
            <p id="selected-room-info" style="margin-bottom:25px;" class="muted">Maximum Guests: 2</p>

            <form id="bookingForm" class="card form-card" aria-label="Booking form">
              <p style="font-style:italic; color:var(--accent-dark); margin-bottom:18px;">You will finalize payment and log in on the next step.</p>

              <div class="form-group">
                <label for="name">Full Name (Contact)</label>
                <input type="text" id="name" required placeholder="John Dela Cruz" autocomplete="name">
                <div class="field-error" id="nameError" aria-live="polite"></div>
                <div class="field-success" id="nameSuccess" aria-live="polite"></div>
              </div>
              <div class="form-group">
                <label for="email">Email Address</label>
                <input type="email" id="email" required placeholder="john@example.com" autocomplete="email">
                <div class="field-error" id="emailError" aria-live="polite"></div>
                <div class="field-success" id="emailSuccess" aria-live="polite"></div>
              </div>

              <div class="form-group" style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
                <div>
                  <label for="checkin">Check-in Date</label>
                  <input type="date" id="checkin" required onchange="initBookingDates(); recalcSummary();">
                  <div class="field-error" id="checkinError" aria-live="polite"></div>
                </div>
                <div>
                  <label for="checkout">Check-out Date</label>
                  <input type="date" id="checkout" required onchange="initBookingDates(); recalcSummary();">
                  <div class="field-error" id="checkoutError" aria-live="polite"></div>
                </div>
              </div>

              <div style="display:grid; grid-template-columns:1fr 1fr; gap:18px; margin-top:12px;">
                <div class="form-group">
                  <label for="nights">Nights</label>
                  <input type="number" id="nights" value="1" min="1" readonly class="muted-input">
                </div>
                <div class="form-group">
                  <label for="guests">Number of Guests (Max 2)</label>
                  <input type="number" id="guests" value="2" min="1" max="2" required onchange="recalcSummary()">
                </div>
              </div>

              <div style="border-top:1px solid var(--border-color); padding-top:15px; margin-top:12px;">
                <label style="display:flex; align-items:center; gap:8px;">
                  <input type="checkbox" id="airport" name="airport" onchange="recalcSummary()">
                  <span style="font-weight:400; color:var(--primary-text);">Add Airport Pickup (<span class="accent">₱300</span> one-time fee)</span>
                </label>
              </div>

              <div class="checkbox-group" style="margin-top:12px;">
                <label style="display:flex; align-items:center; gap:8px;">
                  <input type="checkbox" id="fullPayment" name="fullPayment" value="full" onchange="recalcSummary()">
                  <span style="font-weight:700; color:var(--accent-dark);">Pay Full Amount Now (Recommended)</span>
                </label>
              </div>

              <p class="disclaimer">A non-refundable 50% deposit is required to secure the reservation, unless you choose to pay in full.</p>

              <button type="submit" class="btn primary large-btn" style="width:100%; margin-top:18px;">Proceed to Payment & Login</button>
            </form>
          </div>

          <aside class="booking-summary" data-aos="fade-left" aria-label="Booking summary">
            <div id="room-image-carousel" class="card room-carousel-card">
              <div class="carousel-slide-container" id="carousel-slide-container">
                <img src="https://placehold.co/1200x800/B5A78B/FFFFFF?text=Select+a+Room" alt="Room View" class="carousel-image active" loading="lazy">
              </div>
              <div class="carousel-indicators" id="carousel-indicators"></div>
            </div>

            <h3 style="font-size:22px; margin-top:18px; font-family: 'Playfair Display', serif;">Price Details</h3>
            <div class="card price-summary" style="margin-top:12px;">
              <p style="font-weight:700;">Check-in: <span id="summary-checkin-date" class="accent" style="float:right;">--</span></p>
              <p style="font-weight:700;">Check-out: <span id="summary-checkout-date" class="accent" style="float:right;">--</span></p>

              <p>Room Price (Per Night): <span id="room-price-display" class="accent" style="float:right;">₱2,500</span></p>
              <p>Nights: <span id="summary-nights" style="float:right;">1</span></p>

              <p class="summary-line">Subtotal: <span id="summary-subtotal" style="float:right;">₱2,500</span></p>
              <p>Airport Fee: <span id="summary-airport-fee" style="float:right;">₱0</span></p>

              <p class="summary-line" style="font-weight:800; font-size:18px; padding:12px 0;">Total Booking Amount: <span id="summary-total" class="accent" style="float:right;">₱2,500</span></p>

              <div class="deposit-summary" style="margin-top:10px; padding:12px; border-radius:10px; background:var(--accent-light); border:1px solid var(--accent-dark);">
                <p style="font-weight:700; margin:0;">Payment Due Today: <span id="deposit-required" class="accent" style="float:right;">₱1,250</span></p>
                <p class="muted" id="balance-line" style="font-size:0.95em; margin-top:8px;">Balance Due at Check-in: <span id="balance-due" style="float:right;">₱1,250</span></p>
              </div>
            </div>
          </aside>
        </div>
      </div>
    </section>

    <section id="reviews" class="view">
      <div class="wrap">
        <h2 class="section-title" data-aos="fade-up">Guest Experiences</h2>
        <p class="section-subtitle" data-aos="fade-up" data-aos-delay="100">Read what others have said or share your own memorable stay!</p>

        <div style="display:grid; grid-template-columns:1fr; gap:30px;">
          <div data-aos="fade-up" data-aos-delay="200">
            <h3 style="font-size:26px; margin-top:0; font-family: 'Playfair Display', serif;">What Guests Are Saying</h3>
            <div class="swiper reviews-swiper" style="height: 320px; padding-bottom: 30px;">
              <div class="swiper-wrapper" id="reviews-list">
                <p class="muted swiper-slide" id="reviews-loading" style="text-align:center;">Loading reviews...</p>
              </div>
              <div class="swiper-pagination"></div>
            </div>
          </div>

          <div class="card form-card" data-aos="fade-up" data-aos-delay="300">
            <h3 style="margin-top:0; font-size:24px; text-align:center; font-family: 'Playfair Display', serif;">Share Your Experience</h3>
            <form id="reviewForm" aria-label="Submit review">
              <div class="form-group" style="text-align:center;">
                <label style="margin-bottom:10px;">Your Rating</label>
                <div class="rating" role="radiogroup" aria-label="Rating (1 to 5 stars)">
                  <input type="radio" name="rating" id="star5" value="5" required><label for="star5" title="5 stars" role="radio" aria-checked="false"><i class="fa fa-star" aria-hidden="true"></i></label>
                  <input type="radio" name="rating" id="star4" value="4"><label for="star4" title="4 stars" role="radio" aria-checked="false"><i class="fa fa-star" aria-hidden="true"></i></label>
                  <input type="radio" name="rating" id="star3" value="3"><label for="star3" title="3 stars" role="radio" aria-checked="false"><i class="fa fa-star" aria-hidden="true"></i></label>
                  <input type="radio" name="rating" id="star2" value="2"><label for="star2" title="2 stars" role="radio" aria-checked="false"><i class="fa fa-star" aria-hidden="true"></i></label>
                  <input type="radio" name="rating" id="star1" value="1"><label for="star1" title="1 star" role="radio" aria-checked="false"><i class="fa fa-star" aria-hidden="true"></i></label>
                </div>
              </div>

              <div class="form-group">
                <label for="reviewTitle">Review Title</label>
                <input type="text" id="reviewTitle" required placeholder="Amazing Stay in Bohol!">
              </div>
              <div class="form-group">
                <label for="reviewText">Your Detailed Review</label>
                <textarea id="reviewText" rows="5" required placeholder="The service was exceptional..."></textarea>
              </div>
              <div class="form-group">
                <label for="reviewMedia">Upload Media (Image/Video)</label>
                <input type="file" id="reviewMedia" accept="image/*,video/*">
                <p class="disclaimer">Note: Media files are not stored in this demo. Only text and rating will be saved locally in your browser.</p>
              </div>
              <button type="submit" class="btn primary" id="submitReviewBtn" disabled style="width:100%;">Submit Review</button>
              <p id="review-auth-message" class="muted" style="text-align:center; margin-top:12px; font-weight:700;">You must be logged in to submit a review.</p>
            </form>
          </div>
        </div>
      </div>
    </section>

    <section id="contact" class="view">
      <div class="wrap">
        <h2 class="section-title" data-aos="fade-up">Get In Touch</h2>
        <p class="section-subtitle" data-aos="fade-up" data-aos-delay="100">We are here to help plan your perfect stay in Bohol.</p>

        <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:25px; margin-bottom:25px;">
          <div class="card contact-info-block" data-aos="fade-right" data-aos-delay="200">
            <h4 style="margin:0 0 8px;">Contact Details</h4>
            <p style="font-size:1.05em; margin:6px 0;"><i class="fas fa-envelope accent" style="margin-right:8px;"></i> Email: <strong>lacasadecueto@example.com</strong></p>
            <p style="font-size:1.05em; margin:6px 0;"><i class="fas fa-phone accent" style="margin-right:8px;"></i> Phone: <strong>+63 9XX XXX XXXX</strong></p>
          </div>
          <div class="card contact-info-block" data-aos="fade-left" data-aos-delay="200">
            <h4 style="margin:0 0 8px;">Our Location</h4>
            <ul class="muted" style="list-style:none; padding-left:0; line-height:2;">
              <li><i class="fas fa-map-marker-alt accent" style="margin-right:8px;"></i> Alona Beach — ~15 mins drive</li>
              <li><i class="fas fa-plane-departure accent" style="margin-right:8px;"></i> Panglao International Airport — ~20 mins drive</li>
              <li><i class="fas fa-motorcycle accent" style="margin-right:8px;"></i> Scooter Rental Service — Available On-site</li>
            </ul>
          </div>
        </div>

        <div class="card" data-aos="fade-up" data-aos-delay="300" style="padding:0; margin-bottom:25px; overflow:hidden;">
          <iframe
            src="https://www.google.com/maps?q=Alona+Beach+Panglao+Bohol&z=15&output=embed"
            style="width:100%; min-height:420px; border:0; border-radius:12px;"
            allowfullscreen=""
            loading="lazy"
            referrerpolicy="no-referrer-when-downgrade">
          </iframe>
        </div>

        <div class="card form-card" data-aos="fade-up" data-aos-delay="400">
          <h4 style="font-size:24px; margin-bottom:15px; font-family: 'Playfair Display', serif;">Send Us a Message</h4>
          <form id="messageForm">
            <div class="form-group">
              <label for="contactName">Your Name</label>
              <input type="text" id="contactName" required placeholder="Full Name">
            </div>
            <div class="form-group">
              <label for="contactEmail">Your Email</label>
              <input type="email" id="contactEmail" required placeholder="Email Address">
            </div>
            <div class="form-group">
              <label for="contactMessage">Message</label>
              <textarea id="contactMessage" rows="6" required></textarea>
            </div>
            <button type="submit" class="btn primary">Send Inquiry</button>
          </form>
        </div>
      </div>
    </section>

    <section id="story" class="view">
      <div class="wrap" data-aos="fade-up">
        <h2 class="section-title">Our Story: A Home Away From Home</h2>
        <p class="section-subtitle">La Casa De Cueto is more than just a place to stay—it's a reflection of Boholano heritage and hospitality.</p>
        <div class="card form-card" style="text-align:left;">
          <h3 style="color:var(--accent-dark); margin-top:0; font-family: 'Playfair Display', serif;">Rooted in Tradition</h3>
          <p>The Cueto family has been welcoming guests to Panglao for generations. Our home was built with the vision of offering a genuine, tranquil escape from the bustling tourist spots, while remaining close enough for easy access.</p>
          <h3 style="color:var(--accent-dark); margin-top:25px; font-family: 'Playfair Display', serif;">Our Commitment</h3>
          <p>We believe in sustainable, personalized travel. From the daily fresh linens to personal recommendations for the best local cuisine, our commitment is to ensure your experience in Bohol feels like home.</p>
        </div>
        <div style="text-align:center; margin-top:30px;">
          <button class="btn primary" onclick="showView('rooms')">See Available Rooms</button>
        </div>
      </div>
    </section>

    <section id="login" class="view" aria-labelledby="loginHeading">
      <div class="wrap">
        <h2 id="loginHeading" class="section-title" data-aos="fade-up">Login & Your Account</h2>
        <p class="section-subtitle" data-aos="fade-up" data-aos-delay="60">Sign in to manage bookings, leave reviews, and view your reservation history.</p>

        <div class="auth-section" data-aos="fade-up" data-aos-delay="140">
          <div class="auth-left">
            <div class="welcome-row">
              <div>
                <h3>Welcome Back</h3>
                <p class="small-note">Sign in securely to continue your booking or leave a review.</p>
              </div>
              <div style="text-align:right;">
                <div style="font-weight:700; color:var(--accent-dark);">New here?</div>
                <div class="small-note">Create an account to speed up future bookings.</div>
              </div>
            </div>

            <div class="auth-actions">
              <button class="social-btn social-google" onclick="socialMock('google')" aria-label="Sign in with Google"><i class="fab fa-google"></i> Google</button>
              <button class="social-btn social-facebook" onclick="socialMock('facebook')" aria-label="Sign in with Facebook"><i class="fab fa-facebook"></i> Facebook</button>
            </div>

            <div style="margin-top:10px;">
              <div class="small-note">Or use your email</div>
            </div>

            <div id="accountSummary" aria-live="polite" style="display:none;">
              <div style="display:flex; align-items:center; gap:12px;">
                <div class="avatar" style="width:44px; height:44px;"></div>
                <div>
                  <div id="acctName" style="font-weight:700;"></div>
                  <div id="acctEmail" class="muted" style="font-size:13px;"></div>
                </div>
              </div>
              <div style="display:flex; gap:8px; margin-top:6px;">
                <button class="btn google-btn" onclick="goToBookings()">My Bookings</button>
                <button class="btn" onclick="doLogout()" style="background:#fff; border:1px solid var(--border-color);">Logout</button>
              </div>
            </div>
          </div>

          <div class="auth-right">
            <form id="loginSectionForm" class="form-card" aria-label="Login form (section)">
              <div class="form-group">
                <label for="sectionEmail">Email address</label>
                <input id="sectionEmail" type="email" placeholder="you@example.com" required>
              </div>
              <div class="form-group">
                <label for="sectionName">Full name</label>
                <input id="sectionName" type="text" placeholder="Your name" required>
              </div>
              <div class="form-group" style="display:flex; gap:8px; align-items:center;">
                <label style="display:flex; align-items:center; gap:8px; margin:0;">
                  <input id="rememberMe" type="checkbox"> Remember me
                </label>
                <a href="#" style="margin-left:auto; font-size:0.9em;" onclick="alert('Password reset demo — integrate backend to enable')">Forgot?</a>
              </div>

              <div style="display:flex; gap:8px; margin-top:6px;">
                <button type="submit" class="btn primary" style="flex:1;">Sign in</button>
                <button type="button" class="btn google-btn" onclick="openLoginModal()" title="Quick modal login">Quick</button>
              </div>
              <p class="small-note" style="margin-top:10px;">This demo stores account details locally in your browser. For production, connect a secure backend and authentication provider.</p>
            </form>
          </div>
        </div>
      </div>
    </section>

    <div id="login-modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="modal-card card" style="position:relative;">
        <button class="modal-close" aria-label="Close" onclick="closeLoginModal()"><i class="fas fa-times"></i></button>
        <h3 style="margin-top:0; font-family:'Playfair Display', serif;">Quick Login</h3>
        <form id="loginForm">
          <div class="form-group">
            <label for="loginEmail">Email</label>
            <input id="loginEmail" type="email" required placeholder="you@example.com">
          </div>
          <div class="form-group">
            <label for="loginName">Name</label>
            <input id="loginName" type="text" required placeholder="Your name">
          </div>
          <div style="display:flex; gap:8px; align-items:center;">
            <button type="submit" class="btn primary">Login</button>
            <button type="button" class="btn google-btn" onclick="closeLoginModal()">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <footer class="site-footer" role="contentinfo">
      <div class="wrap">
        <div style="display:flex; justify-content:center; gap:20px;">
          <div>
            <div style="font-weight:700; font-family: 'Playfair Display', serif; font-size:20px;">La Casa De Cueto</div>
            <div class="muted" style="font-size:14px;">Family-run stay in Panglao, Bohol</div>
          </div>
        </div>
        <div style="margin-top:18px;" class="footer-links">
          <a href="#" aria-label="Facebook"><i class="fab fa-facebook"></i></a>
          <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
          <a href="#" aria-label="Email"><i class="fas fa-envelope"></i></a>
        </div>
        <div style="margin-top:18px; color:rgba(255,255,255,0.85); font-size:13px;">© <span id="currentYear"></span> La Casa De Cueto — All rights reserved.</div>
      </div>
    </footer>

    <div id="floatingWidget" class="floating-booking-widget" aria-hidden="true" role="region" aria-label="Quick booking">
      <div style="display:flex; gap:8px; flex-direction:column;" class="form-control-group">
        <label style="font-size:12px; font-weight:700; margin:0;">Quick Book</label>
        <div style="display:flex; gap:8px;">
          <input id="quickCheckin" type="date" aria-label="Quick check-in">
          <input id="quickNights" type="number" min="1" value="1" style="width:70px;" aria-label="Nights">
        </div>
      </div>
      <button class="btn primary" onclick="quickBook()">Book</button>
      <button class="collapse-toggle" aria-label="Collapse booking widget" onclick="toggleFloatingWidgetCollapse()">▾</button>
    </div>
  </main>

  <!-- Lightbox styles -->
  <style>
    #lightboxOverlay { display:none; }
    @media (max-width: 768px) { #lightboxOverlay img { max-width: 98%; max-height: 80%; } }
  </style>

  <!-- Mobile bottom navigation -->
  <nav class="mobile-bottom-nav" role="navigation" aria-label="Mobile navigation">
    <button onclick="showView('home')" aria-label="Home"><i class="fas fa-home"></i><span>Home</span></button>
    <button onclick="showView('rooms')" aria-label="Rooms"><i class="fas fa-bed"></i><span>Rooms</span></button>
    <button onclick="showView('booking')" aria-label="Booking"><i class="fas fa-calendar-check"></i><span>Book</span></button>
    <button onclick="showView('reviews')" aria-label="Reviews"><i class="fas fa-star"></i><span>Reviews</span></button>
    <button onclick="showView('contact')" aria-label="Contact"><i class="fas fa-envelope"></i><span>Contact</span></button>
  </nav>

  <button id="backToTop" aria-label="Back to top" title="Back to top">↑</button>

  <!-- Tooltip / small helper styles -->
  <style>
    [data-tooltip] { position: relative; }
    [data-tooltip]:hover::after {
      content: attr(data-tooltip);
      position: absolute; bottom: calc(100% + 8px); left: 50%; transform: translateX(-50%);
      background: rgba(0,0,0,0.75); color: #fff; padding:6px 8px; border-radius:6px; font-size:12px; white-space:nowrap; z-index:1400;
    }
    .btn { touch-action: manipulation; }
  </style>

  <script src="https://unpkg.com/swiper/swiper-bundle.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js" defer></script>
  <script>
    // Small utilities and initial UI hydration (unchanged except focused behaviors)
    const ROOM_DATA = {
      room1: {
        code: 'room1',
        title: 'Room 1 (Twin Beds)',
        price: 2500,
        maxGuests: 2,
        images: [
          'https://placehold.co/1200x800/B5A78B/FFFFFF?text=Room+1+-+Main',
          'https://placehold.co/1200x800/B5A78B/FFFFFF?text=Room+1+-+Bath',
          'https://placehold.co/1200x800/B5A78B/FFFFFF?text=Room+1+-+Patio'
        ]
      },
      room2: {
        code: 'room2',
        title: 'Room 2 (Twin Beds)',
        price: 2500,
        maxGuests: 2,
        images: [
          'https://placehold.co/1200x800/9E917A/FFFFFF?text=Room+2+-+Main',
          'https://placehold.co/1200x800/9E917A/FFFFFF?text=Room+2+-+Balcony',
          'https://placehold.co/1200x800/9E917A/FFFFFF?text=Room+2+-+Living'
        ]
      }
    };

    // Persisted state for dark mode
    function applyDarkModeFromStorage() {
      // Respect explicit user choice first, otherwise use system preference
      const stored = localStorage.getItem('lcd_dark');
      let isDark = null;
      if (stored === '1' || stored === '0') isDark = stored === '1';
      else isDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      if (isDark) document.documentElement.classList.add('dark-mode'), document.body.classList.add('dark-mode');
      updateDarkToggleButton(isDark);
    }
    function updateDarkToggleButton(isDark) {
      const btn = document.getElementById('dark-mode-toggle');
      if (!btn) return;
      btn.setAttribute('aria-pressed', isDark ? 'true' : 'false');
      btn.innerHTML = isDark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
    }
    function toggleDarkMode() {
      const active = document.documentElement.classList.toggle('dark-mode');
      if (active) document.body.classList.add('dark-mode'); else document.body.classList.remove('dark-mode');
      localStorage.setItem('lcd_dark', active ? '1' : '0');
      updateDarkToggleButton(active);
    }

    // Navigation helper to highlight active and focus elements after scroll
    function showView(viewId) {
      const link = document.querySelector(`.nav a[data-view="${viewId}"]`);
      if (link) {
        document.querySelectorAll('.nav a').forEach(a => a.classList.remove('active'));
        link.classList.add('active');
      }
      const el = document.getElementById(viewId);
      if (el) {
        el.scrollIntoView({behavior:'smooth', block:'start'});
        // small delay to allow scroll then focus first input inside view for accessibility
        setTimeout(() => {
          const focusable = el.querySelector('input, textarea, button, [tabindex]:not([tabindex="-1"])');
          if (focusable) focusable.focus({preventScroll:true});
          // specifically ensure the login section puts focus in email field if present
          if (viewId === 'login') {
            const sEmail = document.getElementById('sectionEmail');
            if (sEmail) { sEmail.focus(); }
          }
        }, 450);
      }
    }

    // Booking logic and UI updates (unchanged)
    function selectRoom(code) {
      const room = ROOM_DATA[code];
      if (!room) return;
      document.getElementById('selected-room').textContent = room.title;
      document.getElementById('selected-room-info').textContent = 'Maximum Guests: ' + room.maxGuests;
      document.getElementById('room-price-display').textContent = '₱' + room.price.toLocaleString();
      populateBookingCarousel(room.images);
      recalcSummary();
      // persist selection across sessions for convenience
      sessionStorage.setItem('lcd_selected_room', code);
      try { localStorage.setItem('lcd_selected_room', code); } catch (e) {}
    }

    function populateBookingCarousel(images) {
      const container = document.getElementById('carousel-slide-container');
      const indicators = document.getElementById('carousel-indicators');
      if (!container || !indicators) return;
      
      // Clear existing content
      container.innerHTML = '';
      indicators.innerHTML = '';
      
      // Create a wrapper for absolute positioning
      container.style.position = 'relative';
      container.style.height = '100%';
      
      // Add images with proper positioning
      images.forEach((src, i) => {
        const img = document.createElement('img');
        img.src = src;
        img.className = 'carousel-image' + (i === 0 ? ' active' : '');
        img.loading = 'lazy';
        img.style.position = 'absolute';
        img.style.top = '0';
        img.style.left = '0';
        img.style.width = '100%';
        img.style.height = '100%';
        img.style.objectFit = 'cover';
        container.appendChild(img);
        
        const dot = document.createElement('button');
        dot.className = 'carousel-indicator' + (i === 0 ? ' active' : '');
        dot.setAttribute('aria-label', 'Image ' + (i+1));
        dot.addEventListener('click', () => { setActiveCarousel(i); });
        indicators.appendChild(dot);
      });
    }

    function setActiveCarousel(index) {
      const images = document.querySelectorAll('#carousel-slide-container .carousel-image');
      const dots = document.querySelectorAll('#carousel-indicators .carousel-indicator');
      images.forEach((img,i) => img.classList.toggle('active', i === index));
      dots.forEach((d,i) => d.classList.toggle('active', i === index));
    }

    function initBookingDates() {
      const checkin = document.getElementById('checkin').value;
      const checkout = document.getElementById('checkout').value;
      const nightsField = document.getElementById('nights');
      if (!checkin || !checkout) return;
      const ci = new Date(checkin);
      const co = new Date(checkout);
      if (co <= ci) {
        co.setDate(ci.getDate() + 1);
        document.getElementById('checkout').valueAsDate = co;
      }
      const nights = Math.round((new Date(document.getElementById('checkout').value) - new Date(document.getElementById('checkin').value)) / (1000*60*60*24));
      nightsField.value = nights > 0 ? nights : 1;
      document.getElementById('summary-checkin-date').textContent = checkin || '--';
      document.getElementById('summary-checkout-date').textContent = document.getElementById('checkout').value || '--';
      document.getElementById('summary-nights').textContent = nightsField.value;
    }

    function recalcSummary() {
      const sel = sessionStorage.getItem('lcd_selected_room') || 'room1';
      const room = ROOM_DATA[sel];
      const nights = parseInt(document.getElementById('nights').value || '1', 10) || 1;
      const airport = document.getElementById('airport').checked;
      const full = document.getElementById('fullPayment').checked;
      const subtotal = room.price * nights;
      const airportFee = airport ? 300 : 0;
      const total = subtotal + airportFee;
      const deposit = full ? total : Math.round(total * 0.5);
      const balance = full ? 0 : total - deposit;

      document.getElementById('summary-subtotal').textContent = '₱' + subtotal.toLocaleString();
      document.getElementById('summary-airport-fee').textContent = '₱' + airportFee.toLocaleString();
      document.getElementById('summary-total').textContent = '₱' + total.toLocaleString();
      document.getElementById('deposit-required').textContent = '₱' + deposit.toLocaleString();
      document.getElementById('balance-due').textContent = '₱' + balance.toLocaleString();

      if (!document.querySelectorAll('#carousel-slide-container .carousel-image').length) {
        populateBookingCarousel(room.images);
      }
    }

    // Authentication (demo)
    // Focus trap helpers for accessible modals
    // Generate a stable demo user id (uses crypto.randomUUID when available)
    function generateUserId() {
      try {
        if (typeof crypto !== 'undefined' && typeof crypto.randomUUID === 'function') return crypto.randomUUID();
      } catch (e) {}
      return 'u' + Date.now() + Math.floor(Math.random()*10000);
    }
    (function(){
      let _trapTarget = null;
      let _previousFocused = null;
      function focusableElements(el){
        if(!el) return [];
        return Array.from(el.querySelectorAll('a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])'))
          .filter(e => e.offsetWidth || e.offsetHeight || e.getClientRects().length);
      }
      window.trapFocus = function(modal){
        if(!modal) return;
        _previousFocused = document.activeElement;
        _trapTarget = modal;
        const els = focusableElements(modal);
        if(els.length) els[0].focus();
        document.addEventListener('focus', enforceFocus, true);
      };
      window.releaseFocus = function(){
        document.removeEventListener('focus', enforceFocus, true);
        if(_previousFocused && typeof _previousFocused.focus === 'function') _previousFocused.focus();
        _trapTarget = null; _previousFocused = null;
      };
      function enforceFocus(e){
        if(!_trapTarget) return;
        if(!_trapTarget.contains(e.target)){
          e.stopPropagation();
          const els = focusableElements(_trapTarget);
          if(els.length) els[0].focus();
        }
      }
    })();

    function openLoginModal() {
      const modal = document.getElementById('login-modal');
      modal.classList.add('show');
      modal.setAttribute('aria-hidden', 'false');
      if (typeof trapFocus === 'function') trapFocus(modal);
      setTimeout(() => document.getElementById('loginEmail')?.focus(), 120);
    }
    function closeLoginModal() {
      const modal = document.getElementById('login-modal');
      modal.classList.remove('show');
      modal.setAttribute('aria-hidden', 'true');
      if (typeof releaseFocus === 'function') releaseFocus();
    }

    // Mobile menu toggle (global so inline onclick works)
    function toggleMobileMenu(force) {
      const overlay = document.getElementById('mobileNavOverlay');
      const btn = document.getElementById('mobileMenuButton');
      const show = typeof force === 'boolean' ? force : !overlay.classList.contains('show');
      overlay.classList.toggle('show', show);
      overlay.setAttribute('aria-hidden', show ? 'false' : 'true');
      if (btn) btn.setAttribute('aria-expanded', show ? 'true' : 'false');
      if (show && typeof trapFocus === 'function') trapFocus(overlay);
      if (!show && typeof releaseFocus === 'function') releaseFocus();
    }

    // Floating widget collapse toggle
    function toggleFloatingWidgetCollapse() {
      const w = document.getElementById('floatingWidget');
      if (!w) return;
      const collapsed = !w.classList.toggle('collapsed');
      // store collapsed state
      localStorage.setItem('lcd_widget_collapsed', w.classList.contains('collapsed') ? '1' : '0');
      // if expanded, ensure it's visible
      if (!w.classList.contains('collapsed')) w.classList.add('show');
    }

    function isLoggedIn() { return !!localStorage.getItem('lcd_user'); }
    function getCurrentUser() { try { return JSON.parse(localStorage.getItem('lcd_user')); } catch(e) { return null; } }
    function doLogout() { localStorage.removeItem('lcd_user'); refreshAuthUI(); alert('You have been logged out (demo).'); }
    function goToBookings() { alert('This would go to “My Bookings” (demo). Implement backend to show actual bookings.'); }
    function socialMock(provider) { alert('Social sign-in (' + provider + ') is a placeholder in this demo. Integrate OAuth on the server for production.'); }

    // DOM interactions & handlers
    document.addEventListener('DOMContentLoaded', () => {
      applyDarkModeFromStorage();
      document.getElementById('currentYear').textContent = new Date().getFullYear();

      // modal login handler
      const loginForm = document.getElementById('loginForm');
      loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const email = document.getElementById('loginEmail').value.trim();
        const name = document.getElementById('loginName').value.trim();
        if (!email || !name) return;
        // Reuse existing user id if same email is already stored
        let uid = null;
        try {
          const existing = JSON.parse(localStorage.getItem('lcd_user') || 'null');
          if (existing && existing.id && existing.email && existing.email.toLowerCase() === email.toLowerCase()) {
            uid = existing.id;
          }
        } catch (e) { uid = null; }
        if (!uid) uid = generateUserId();
        localStorage.setItem('lcd_user', JSON.stringify({id: uid, email, name}));
        closeLoginModal();
        refreshAuthUI();
        alert('Logged in (demo).');
      });

      // Toast/snackbar helper
      window.showToast = function(message, type = 'info', duration = 3500) {
        let container = document.getElementById('toastContainer');
        if (!container) {
          container = document.createElement('div');
          container.id = 'toastContainer';
          container.className = 'toast-container';
          document.body.appendChild(container);
        }
        const t = document.createElement('div');
        t.className = `toast ${type}`;
        t.textContent = message;
        container.appendChild(t);
        // allow CSS transition
        requestAnimationFrame(() => t.classList.add('show'));
        setTimeout(() => { t.classList.remove('show'); setTimeout(()=> t.remove(), 250); }, duration);
      };

      // showUndoToast: creates a toast with an action button (e.g., Undo)
      function showUndoToast(message, actionLabel, actionCb, duration = 6000) {
        let container = document.getElementById('toastContainer');
        if (!container) {
          container = document.createElement('div');
          container.id = 'toastContainer';
          container.className = 'toast-container';
          document.body.appendChild(container);
        }
        const t = document.createElement('div');
        t.className = 'toast info';
        const msg = document.createElement('span'); msg.textContent = message;
        const act = document.createElement('button'); act.className = 'btn google-btn'; act.style.marginLeft = '12px'; act.textContent = actionLabel;
        act.addEventListener('click', () => { try { actionCb(); t.classList.remove('show'); setTimeout(()=>t.remove(),250); } catch(e){ console.error(e); } });
        t.appendChild(msg); t.appendChild(act);
        container.appendChild(t);
        requestAnimationFrame(() => t.classList.add('show'));
        setTimeout(() => { if (t) { t.classList.remove('show'); setTimeout(()=> t.remove(),250); } }, duration);
      }

      // Real-time input validation (name & email)
      function isValidEmail(v){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v); }
      const nameInput = document.getElementById('name');
      const emailInput = document.getElementById('email');
      // Enhanced real-time validation with messages
      function setFieldError(el, message){
        if(!el) return;
        el.classList.add('invalid'); el.classList.remove('valid'); el.setAttribute('aria-invalid','true');
        const err = document.getElementById(el.id + 'Error');
        const ok = document.getElementById(el.id + 'Success');
        if(err) { err.textContent = message; err.style.display = 'block'; }
        if(ok) ok.style.display = 'none';
      }
      function setFieldValid(el, message){
        if(!el) return;
        el.classList.remove('invalid'); el.classList.add('valid'); el.setAttribute('aria-invalid','false');
        const err = document.getElementById(el.id + 'Error');
        const ok = document.getElementById(el.id + 'Success');
        if(ok) { ok.textContent = message || 'Looks good'; ok.style.display = 'block'; }
        if(err) err.style.display = 'none';
      }

      if (nameInput) nameInput.addEventListener('input', () => {
        if (nameInput.value.trim().length < 2) { setFieldError(nameInput, 'Please enter your full name.'); }
        else { setFieldValid(nameInput, 'Name looks good.'); }
      });
      if (emailInput) emailInput.addEventListener('input', () => {
        if (!isValidEmail(emailInput.value.trim())) { setFieldError(emailInput, 'Please enter a valid email address.'); }
        else { setFieldValid(emailInput, 'Email looks valid.'); }
      });

      // populate gallery with skeleton then replace

      // login section handler
      const loginSectionForm = document.getElementById('loginSectionForm');
      loginSectionForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const email = document.getElementById('sectionEmail').value.trim();
        const name = document.getElementById('sectionName').value.trim();
        const remember = document.getElementById('rememberMe').checked;
        if (!email || !name) return;
        // Reuse existing id if same email found, otherwise create
        let uid = null;
        try {
          const existing = JSON.parse(localStorage.getItem('lcd_user') || 'null');
          if (existing && existing.id && existing.email && existing.email.toLowerCase() === email.toLowerCase()) {
            uid = existing.id;
          }
        } catch (e) { uid = null; }
        if (!uid) uid = generateUserId();
        localStorage.setItem('lcd_user', JSON.stringify({id: uid, email, name}));
        refreshAuthUI();
        showView('booking');
      });

      // Booking form submit handler — require dates first, otherwise open calendar and resume after confirmation
      const bookingForm = document.getElementById('bookingForm');
      function bookingFormHandler(e) {
        e.preventDefault();
        const checkinVal = document.getElementById('checkin').value;
        const checkoutVal = document.getElementById('checkout').value;

        // If dates are not selected, open the calendar and set a resume intent flag
        if (!checkinVal || !checkoutVal) {
          window._booking_resume_intent = true;
          const selected = sessionStorage.getItem('lcd_selected_room') || 'room1';
          if (typeof openCalendarForRoom === 'function') {
            openCalendarForRoom(selected);
          } else {
            // Fallback: navigate to booking view so user can manually select dates
            showView('booking');
          }
          return;
        }

        // Validate form before proceeding to confirmation
        if (!validateBookingForm()) return;

        // disable submit to avoid double submits while modal opens
        const submitBtn = bookingForm.querySelector('button[type="submit"]');
        if (submitBtn) { submitBtn.disabled = true; submitBtn.dataset.processing = '1'; }
        // Show booking confirmation modal
        openBookingConfirm();
        // Re-enable submit after small delay to restore UX (real app would wait for server response)
        setTimeout(() => { if (submitBtn) { submitBtn.disabled = false; delete submitBtn.dataset.processing; } }, 800);
      }
      bookingForm.addEventListener('submit', bookingFormHandler);

      // Booking confirmation modal handlers
      function openBookingConfirm() {
        const modal = document.getElementById('bookingConfirmModal');
        if (!modal) return;
        
        // Fill confirmation details
        const roomCode = sessionStorage.getItem('lcd_selected_room') || 'room1';
        const room = ROOM_DATA[roomCode];
        document.getElementById('confirm-room').textContent = room.title;
        document.getElementById('confirm-name').textContent = document.getElementById('name').value;
        document.getElementById('confirm-email').textContent = document.getElementById('email').value;
        document.getElementById('confirm-checkin').textContent = document.getElementById('checkin').value;
        document.getElementById('confirm-checkout').textContent = document.getElementById('checkout').value;
        document.getElementById('confirm-guests').textContent = document.getElementById('guests').value + ' guest(s)';
        document.getElementById('confirm-airport').textContent = document.getElementById('airport').checked ? 'Yes (+₱300)' : 'No';
        document.getElementById('confirm-payment').textContent = document.getElementById('fullPayment').checked ? 'Pay full amount now' : '50% deposit now, balance at check-in';
        document.getElementById('confirm-total').textContent = document.getElementById('summary-total').textContent;
        document.getElementById('confirm-deposit').textContent = document.getElementById('deposit-required').textContent;

        modal.classList.add('show');
        modal.setAttribute('aria-hidden', 'false');
        if (typeof trapFocus === 'function') trapFocus(modal);
      }

      function closeBookingConfirm() {
        const modal = document.getElementById('bookingConfirmModal');
        if (!modal) return;
        modal.classList.remove('show');
        modal.setAttribute('aria-hidden', 'true');
        if (typeof releaseFocus === 'function') releaseFocus();
      }

      function proceedWithBooking() {
        const modal = document.getElementById('bookingConfirmModal');
        const confirmBtn = modal?.querySelector('button[onclick="proceedWithBooking()"]') || modal?.querySelector('.btn.primary');
        if (confirmBtn) { confirmBtn.disabled = true; confirmBtn.textContent = 'Processing...'; }
        // Resume normal demo flow
        if (!isLoggedIn()) { closeBookingConfirm(); showView('login'); openLoginModal(); if (confirmBtn) { confirmBtn.disabled = false; confirmBtn.textContent = 'Confirm & Continue'; } return; }
        // simulate processing and show success
        setTimeout(() => {
          closeBookingConfirm();
          showToast('Booking confirmed. Proceeding to payment... (demo)', 'success');
          // Reset confirm button
          if (confirmBtn) { confirmBtn.disabled = false; confirmBtn.textContent = 'Confirm & Continue'; }
          // final demo message
          setTimeout(() => alert('Proceeding to payment... (demo). Your booking details are stored only locally in this demo.'), 300);
        }, 900);
      }

      // contact form
      document.getElementById('messageForm').addEventListener('submit', (e) => {
        e.preventDefault();
        alert('Message sent (demo). Thank you!');
        e.target.reset();
      });

      // review form handling
      refreshAuthUI();
      document.getElementById('reviewForm').addEventListener('submit', (e) => {
        e.preventDefault();
        if (!isLoggedIn()) { showView('login'); openLoginModal(); return; }
        const rating = document.querySelector('input[name="rating"]:checked')?.value || 0;
        const title = document.getElementById('reviewTitle').value.trim();
        const text = document.getElementById('reviewText').value.trim();
        const user = getCurrentUser();
        const reviews = JSON.parse(localStorage.getItem('lcd_reviews') || '[]');
        // include authorId for stricter ownership checks
        reviews.unshift({ id: Date.now(), rating: Number(rating), title, text, author: user.name || user.email, authorId: user.id, created_at: new Date().toISOString() });
        localStorage.setItem('lcd_reviews', JSON.stringify(reviews));
        renderReviews();
        e.target.reset();
        alert('Thanks — your review has been saved locally.');
      });

      // floating widget
      document.getElementById('floatingWidget').classList.add('show');
      document.getElementById('floatingWidget').setAttribute('aria-hidden','false');

      // restore floating widget collapsed state from storage
      try {
        const w = document.getElementById('floatingWidget');
        if (localStorage.getItem('lcd_widget_collapsed') === '1') w.classList.add('collapsed');
      } catch (e) {}

      // set min dates to prevent selecting past dates
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth()+1).padStart(2,'0');
      const dd = String(today.getDate()).padStart(2,'0');
      const isoToday = `${yyyy}-${mm}-${dd}`;
      ['checkin','checkout','quickCheckin'].forEach(id => {
        const el = document.getElementById(id);
        if (el && el.type === 'date') el.setAttribute('min', isoToday);
      });

      // Restore booking draft (if any)
      try {
        const draft = JSON.parse(localStorage.getItem('lcd_booking_draft') || '{}');
        if (draft) {
          if (draft.name) document.getElementById('name').value = draft.name;
          if (draft.email) document.getElementById('email').value = draft.email;
          if (draft.checkin) document.getElementById('checkin').value = draft.checkin;
          if (draft.checkout) document.getElementById('checkout').value = draft.checkout;
          if (draft.guests) document.getElementById('guests').value = draft.guests;
          initBookingDates(); recalcSummary();
        }
      } catch (e) {}

      // Save booking draft on change
      ['name','email','checkin','checkout','guests','airport','fullPayment'].forEach(id => {
        const el = document.getElementById(id);
        if (!el) return;
        el.addEventListener('change', () => {
          const draft = {
            name: document.getElementById('name').value || '',
            email: document.getElementById('email').value || '',
            checkin: document.getElementById('checkin').value || '',
            checkout: document.getElementById('checkout').value || '',
            guests: document.getElementById('guests').value || '1',
            airport: document.getElementById('airport').checked,
            fullPayment: document.getElementById('fullPayment').checked,
          };
          localStorage.setItem('lcd_booking_draft', JSON.stringify(draft));
        });
      });

      // back-to-top and active-section handling
      const backBtn = document.getElementById('backToTop');
      function updateUIOnScroll(){
        const showBack = window.scrollY > 400;
        if (backBtn) backBtn.style.display = showBack ? 'flex' : 'none';
      }
      updateUIOnScroll();
      window.addEventListener('scroll', updateUIOnScroll, { passive: true });

      // IntersectionObserver-based active section highlighting (more reliable)
      const sectionsToObserve = ['home','rooms','booking','reviews','contact','story','login'];
      const ioOptions = { root: null, rootMargin: '0px 0px -60%', threshold: 0 };
      try{
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(en => {
            if (en.isIntersecting) {
              const id = en.target.id;
              document.querySelectorAll('.nav a').forEach(a => a.classList.toggle('active', a.dataset.view === id));
              // mobile bottom nav
              document.querySelectorAll('.mobile-bottom-nav button').forEach(btn => {
                const onclick = (btn.getAttribute('onclick')||'');
                const view = onclick.match(/showView\('([^']+)'\)/)?.[1];
                btn.classList.toggle('active', view === id);
              });
            }
          });
        }, ioOptions);
        sectionsToObserve.forEach(s => { const el = document.getElementById(s); if (el) observer.observe(el); });
      } catch(e) { /* fallback already handles basic active state */ }
      updateUIOnScroll();
      window.addEventListener('scroll', updateUIOnScroll, { passive: true });
      if (backBtn) backBtn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));

      // expose a small validation helper used on submit
      window.validateBookingForm = function(){
        const name = document.getElementById('name')?.value.trim();
        const email = document.getElementById('email')?.value.trim();
        const checkin = document.getElementById('checkin')?.value;
        const checkout = document.getElementById('checkout')?.value;
        // reset inline errors
        try { document.getElementById('nameError').style.display='none'; document.getElementById('emailError').style.display='none'; document.getElementById('checkinError').style.display='none'; document.getElementById('checkoutError').style.display='none'; } catch(e){}
        if (!name || name.length < 2) { setFieldError(document.getElementById('name'), 'Please enter your full name.'); return false; }
        if (!isValidEmail(email)) { setFieldError(document.getElementById('email'), 'Please enter a valid email address.'); return false; }
        if (!checkin) { setFieldError(document.getElementById('checkin'), 'Please select a check-in date.'); return false; }
        if (!checkout) { setFieldError(document.getElementById('checkout'), 'Please select a check-out date.'); return false; }
        if (new Date(checkout) <= new Date(checkin)) { setFieldError(document.getElementById('checkout'), 'Check-out must be after check-in.'); return false; }
        return true;
      };

      // close mobile menu if overlay clicked
      const overlay = document.getElementById('mobileNavOverlay');
      if (overlay) overlay.addEventListener('click', (ev) => { if (ev.target === overlay) toggleMobileMenu(false); });

        // add simple tooltips to room cards and book buttons
        document.querySelectorAll('.room-card').forEach(rc => {
          const btn = rc.querySelector('.btn');
          if (btn) btn.setAttribute('data-tooltip','Book Now');
          rc.setAttribute('data-tooltip','View room details');
        });

      // gallery + swipers
      populateRoomGallery();
  // Prefer persistent last selected room, fallback to session or default
  const saved = localStorage.getItem('lcd_selected_room') || sessionStorage.getItem('lcd_selected_room') || 'room1';
  selectRoom(saved);

      if (typeof AOS !== 'undefined') AOS.init({ once: true, duration: 700, easing: 'ease-in-out' });

      // Hero video autoplay & parallax
      (function(){
        const video = document.getElementById('heroVideo');
        const parContent = document.querySelector('.hero-parallax');
        const isMobile = /Mobi|Android/i.test(navigator.userAgent);
        // Try to play video only if not mobile and video element has a source
        if (video && video.querySelector('source') && !isMobile) {
          // Avoid autoplay on slow connections or if Save-Data enabled
          const conn = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
          const slow = conn && (conn.saveData || (conn.effectiveType && /(2g|slow-2g)/i.test(conn.effectiveType)));
          if (!slow) {
            video.play().catch(()=>{});
          }
        }

        // Parallax: translate hero content on scroll slightly for depth
        if (parContent) {
          function onScroll(){
            const sc = Math.min(window.scrollY, 200);
            const t = sc * 0.12; // small multiplier for subtle effect
            parContent.style.transform = `translateY(${t}px)`;
          }
          window.addEventListener('scroll', onScroll, { passive: true });
          onScroll();
        }
      })();

      // initial page fade-in for smoother load
      setTimeout(() => {
        document.querySelectorAll('.fade-in').forEach(el => el.classList.add('show'));
        document.documentElement.classList.add('page-ready');
      }, 120);

      setTimeout(() => {
        try {
          const mainSwiper = new Swiper('.room-gallery-top', {
            spaceBetween: 10,
            slidesPerView: 1,
            loop: true,
            autoplay: { delay: 4500, disableOnInteraction: false },
            thumbs: { swiper: { el: '.room-gallery-thumbs', slidesPerView: 4 } },
          });
        } catch (e) {}
        try {
          new Swiper('.reviews-swiper', {
            slidesPerView: 1,
            loop: true,
            autoplay: { delay: 5000 },
            pagination: { el: '.swiper-pagination', clickable: true }
          });
        } catch (e) {}
        renderReviews();
      }, 300);

      // Lightbox implementation (simple, lightweight)
      const lightbox = (function(){
        let currentIndex = 0;
        const overlay = document.createElement('div');
        overlay.id = 'lightboxOverlay';
        overlay.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.85);display:none;align-items:center;justify-content:center;z-index:2000;'
        const img = document.createElement('img'); img.style.maxWidth = '90%'; img.style.maxHeight='90%'; img.style.boxShadow='0 20px 60px rgba(0,0,0,0.6)'; img.alt='';
        const prev = document.createElement('button'); prev.textContent='‹'; prev.style.cssText='position:absolute;left:18px;top:50%;transform:translateY(-50%);font-size:48px;background:transparent;border:none;color:white;cursor:pointer;';
        const next = document.createElement('button'); next.textContent='›'; next.style.cssText='position:absolute;right:18px;top:50%;transform:translateY(-50%);font-size:48px;background:transparent;border:none;color:white;cursor:pointer;';
        overlay.appendChild(prev); overlay.appendChild(img); overlay.appendChild(next);
        document.body.appendChild(overlay);
        overlay.addEventListener('click', (e) => { if (e.target === overlay) overlay.style.display='none'; });
        prev.addEventListener('click', (e) => { e.stopPropagation(); show(currentIndex - 1); });
        next.addEventListener('click', (e) => { e.stopPropagation(); show(currentIndex + 1); });
        document.addEventListener('keydown', (e) => { if (overlay.style.display !== 'flex') return; if (e.key === 'Escape') overlay.style.display='none'; if (e.key === 'ArrowLeft') show(currentIndex - 1); if (e.key === 'ArrowRight') show(currentIndex + 1); });
        function show(i){
          const imgs = document.querySelectorAll('.room-gallery-container .swiper-slide img');
          if (!imgs.length) return;
          currentIndex = (i + imgs.length) % imgs.length;
          img.src = imgs[currentIndex].src;
          overlay.style.display = 'flex';
        }
        return { open: show };
      })();
      function openLightbox(index){ try { window.scrollTo({top:0, behavior:'instant'}); lightbox.open(index); } catch(e){} }

      document.addEventListener('keydown', (ev) => { 
        if (ev.key === 'Escape') {
          closeLoginModal();
          closeBookingConfirm();
        }
      });
    });

    function populateRoomGallery() {
      const mainWrapper = document.getElementById('room-gallery-main-slides');
      const thumbsWrapper = document.getElementById('room-gallery-thumb-slides');
      // show skeleton while building
      mainWrapper.innerHTML = '<div class="skeleton img" style="border-radius:16px;"></div>';
      thumbsWrapper.innerHTML = '';
      // build slides then remove skeleton
      setTimeout(() => {
        mainWrapper.innerHTML = '';
        thumbsWrapper.innerHTML = '';
        Object.values(ROOM_DATA).forEach(room => {
          room.images.forEach(src => {
            const slide = document.createElement('div'); slide.className = 'swiper-slide';
            const img = document.createElement('img'); img.src = src; img.loading = 'lazy'; img.alt = room.title; img.className = 'img-zoom gallery-item';
            slide.appendChild(img);
            mainWrapper.appendChild(slide);

            const tslide = document.createElement('div'); tslide.className = 'swiper-slide';
            const timg = document.createElement('img'); timg.src = src; timg.loading='lazy'; timg.alt = room.title;
            tslide.appendChild(timg);
            thumbsWrapper.appendChild(tslide);
          });
        });
        // attach lightbox handlers
        document.querySelectorAll('.gallery-item').forEach((el, i) => {
          el.addEventListener('click', (ev) => { openLightbox(i); });
        });
      }, 220);
    }

    function refreshAuthUI() {
      const logged = isLoggedIn();
      const submitBtn = document.getElementById('submitReviewBtn');
      const authMsg = document.getElementById('review-auth-message');
      const loginLink = document.getElementById('login-nav-link');

      if (logged) {
        submitBtn.disabled = false;
        authMsg.textContent = 'You are logged in.';
        authMsg.classList.remove('muted');
        loginLink.textContent = 'Logout';
        loginLink.onclick = (e) => { e.preventDefault(); doLogout(); showView('home'); };
      } else {
        submitBtn.disabled = true;
        authMsg.textContent = 'You must be logged in to submit a review.';
        loginLink.textContent = 'Login';
        loginLink.onclick = (e) => { e.preventDefault(); showView('login'); };
      }

      const accountSummary = document.getElementById('accountSummary');
      const acctName = document.getElementById('acctName');
      const acctEmail = document.getElementById('acctEmail');
      const avatar = accountSummary?.querySelector('.avatar');
      if (logged) {
        const user = getCurrentUser();
        accountSummary.style.display = 'flex';
        acctName.textContent = user.name || 'Guest';
        acctEmail.textContent = user.email || '';
        if (avatar) avatar.textContent = (user.name || user.email || 'G').charAt(0).toUpperCase();
      } else {
        accountSummary.style.display = 'none';
      }
    }

    function renderReviews() {
      const list = document.getElementById('reviews-list');
      const reviews = JSON.parse(localStorage.getItem('lcd_reviews') || '[]');
      // Keep structured data in sync even if there are no reviews
      try { updateReviewsJsonLd(reviews); } catch(e) {}
      list.innerHTML = '';
      if (!reviews.length) {
        // show a skeleton card while empty
        list.innerHTML = '<div class="swiper-slide"><div class="card" style="padding:20px;"><div class="skeleton text" style="width:60%"></div><div class="skeleton text" style="width:40%"></div><div class="skeleton text" style="width:80%; height:80px; margin-top:10px;"></div></div></div>';
        return;
      }
      reviews.forEach(r => {
        const slide = document.createElement('div');
        slide.className = 'swiper-slide';
        // Determine if current user can edit/delete this review
        const currentUser = getCurrentUser();
        const logged = isLoggedIn();
        let canManage = false;
        // Prefer strict authorId matching when available
        if (logged && currentUser) {
          if (r.authorId && currentUser.id && r.authorId === currentUser.id) {
            canManage = true;
          } else {
            // Fallback/migration: if review lacks authorId but author string matches current user, attach id
            const author = (r.author || '').toLowerCase();
            const uname = (currentUser.name || '').toLowerCase();
            const uemail = (currentUser.email || '').toLowerCase();
            if (author && (author === uname || author === uemail)) {
              try { r.authorId = currentUser.id; localStorage.setItem('lcd_reviews', JSON.stringify(reviews)); } catch(e){}
              canManage = true;
            }
          }
        }

        const manageButtonsHtml = canManage ? `<div style="margin-top:10px; text-align:right; display:flex; gap:8px; justify-content:flex-end;"><button class=\"btn google-btn\" onclick=\"openEditReview(${r.id})\">Edit</button><button class=\"btn google-btn\" onclick=\"deleteReview(${r.id})\">Delete</button></div>` : '';

        slide.innerHTML = `<div class="review-item">
          <div class="review-header">
            <div style="display:flex; align-items:center; gap:8px;">
              <div class="avatar">${(r.author||'G').charAt(0).toUpperCase()}</div>
              <div>
                <div style="font-weight:700;">${escapeHtml(r.author||'Guest')}</div>
                <div class="muted" style="font-size:12px;">${new Date(r.created_at).toLocaleDateString()}</div>
              </div>
            </div>
            <div style="font-weight:700; color:var(--star-color);">${'★'.repeat(r.rating)}${'☆'.repeat(5-r.rating)}</div>
          </div>
          <h4 class="review-title">${escapeHtml(r.title)}</h4>
          <p class="muted">${escapeHtml(r.text)}</p>
          ${manageButtonsHtml}
        </div>`;
        list.appendChild(slide);
      });
      // Also update JSON-LD for reviews so structured data reflects stored reviews (useful for testing/demo)
      try { updateReviewsJsonLd(reviews); } catch(e) { /* silent */ }
    }

    // Generate or update a JSON-LD script containing Review objects from stored reviews
    function updateReviewsJsonLd(reviews){
      const scriptId = 'reviews-jsonld';
      const node = document.getElementById(scriptId);
      const lodName = 'La Casa De Cueto';
      const graph = [];
      // Add the main lodging business node so reviews can reference it
      graph.push({
        '@type': 'LodgingBusiness',
        'name': lodName
      });
      reviews.slice(0,10).forEach(r => {
        const reviewNode = {
          '@type': 'Review',
          'author': { '@type': 'Person', 'name': r.author || 'Guest' },
          'datePublished': (r.created_at) ? new Date(r.created_at).toISOString() : new Date().toISOString(),
          'reviewBody': r.text || '',
          'name': r.title || '',
          'reviewRating': { '@type': 'Rating', 'ratingValue': String(r.rating || 0) }
        };
        graph.push(reviewNode);
      });

      const ld = { '@context': 'https://schema.org', '@graph': graph };
      const json = JSON.stringify(ld, null, 2);
      if (node) node.textContent = json;
      else {
        const s = document.createElement('script');
        s.type = 'application/ld+json';
        s.id = scriptId;
        s.textContent = json;
        document.head.appendChild(s);
      }
    }

    // Delete a review by id (only for reviews authored by the current user)
    function deleteReview(id) {
      if (!confirm('Delete this review? You can undo this for a short time.')) return;
      try {
        const reviews = JSON.parse(localStorage.getItem('lcd_reviews') || '[]');
        const idx = reviews.findIndex(r => r.id === id);
        if (idx === -1) { showToast('Review not found.', 'error'); return; }
        // Only allow deletion if current user is author
        const user = getCurrentUser();
        if (!user) { showToast('You must be logged in to delete your review.', 'error'); return; }
        // Prefer strict authorId match, fallback to legacy author string checks
        if (reviews[idx].authorId) {
          if (reviews[idx].authorId !== user.id) { showToast('You can only delete your own reviews.', 'error'); return; }
        } else {
          const author = (reviews[idx].author || '').toLowerCase();
          const uname = (user.name || '').toLowerCase();
          const uemail = (user.email || '').toLowerCase();
          if (!(author === uname || author === uemail)) { showToast('You can only delete your own reviews.', 'error'); return; }
          // migrate to authorId for future strict checks
          try { reviews[idx].authorId = user.id; } catch(e){}
        }

        // Perform deletion but allow undo for a short window
        const deleted = reviews.splice(idx, 1)[0];
        localStorage.setItem('lcd_reviews', JSON.stringify(reviews));
        renderReviews();

        // Prepare pending deletions map
        if (!window._pendingReviewDeletions) window._pendingReviewDeletions = {};
        // Clear any existing timeout for this id
        if (window._pendingReviewDeletions[id] && window._pendingReviewDeletions[id].timeoutId) {
          clearTimeout(window._pendingReviewDeletions[id].timeoutId);
        }

        // Show undo toast
        const undoDuration = 6000; // ms
        const undoAction = () => {
          // restore review
          try {
            const cur = JSON.parse(localStorage.getItem('lcd_reviews') || '[]');
            cur.unshift(deleted);
            localStorage.setItem('lcd_reviews', JSON.stringify(cur));
            renderReviews();
            showToast('Deletion undone.', 'success');
            // cancel timeout
            if (window._pendingReviewDeletions[id] && window._pendingReviewDeletions[id].timeoutId) clearTimeout(window._pendingReviewDeletions[id].timeoutId);
            delete window._pendingReviewDeletions[id];
          } catch (e) { console.error(e); showToast('Could not restore review.', 'error'); }
        };

        // Create undo toast with action button
        showUndoToast('Review deleted.', 'Undo', undoAction, undoDuration);

        // Set finalizer to remove pending record after duration (no-op since already removed)
        const tid = setTimeout(() => {
          if (window._pendingReviewDeletions && window._pendingReviewDeletions[id]) {
            delete window._pendingReviewDeletions[id];
          }
        }, undoDuration + 200);
        window._pendingReviewDeletions[id] = { deleted, timeoutId: tid };

      } catch (e) {
        console.error(e);
        showToast('Could not delete review.', 'error');
      }
    }

    // --- Edit review flow: open modal, allow editing title/text/rating, save back to storage
    function openEditReview(id) {
      try {
        const reviews = JSON.parse(localStorage.getItem('lcd_reviews') || '[]');
        const idx = reviews.findIndex(r => r.id === id);
        if (idx === -1) { showToast('Review not found.', 'error'); return; }
        const user = getCurrentUser();
        if (!user) { showToast('You must be logged in to edit your review.', 'error'); return; }
        // Prefer strict authorId matching
        if (reviews[idx].authorId) {
          if (reviews[idx].authorId !== user.id) { showToast('You can only edit your own reviews.', 'error'); return; }
        } else {
          const author = (reviews[idx].author || '').toLowerCase();
          const uname = (user.name || '').toLowerCase();
          const uemail = (user.email || '').toLowerCase();
          if (!(author === uname || author === uemail)) { showToast('You can only edit your own reviews.', 'error'); return; }
          // migrate
          try { reviews[idx].authorId = user.id; localStorage.setItem('lcd_reviews', JSON.stringify(reviews)); } catch(e){}
        }

        // Populate modal fields
        document.getElementById('editReviewId').value = id;
        document.getElementById('editReviewTitle').value = reviews[idx].title || '';
        document.getElementById('editReviewText').value = reviews[idx].text || '';
        // clear rating radios then set
        const val = String(reviews[idx].rating || 0);
        document.querySelectorAll('#editReviewModal input[name="edit-rating"]').forEach(inp => inp.checked = (inp.value === val));

        const modal = document.getElementById('editReviewModal');
        modal.classList.add('show'); modal.setAttribute('aria-hidden','false');
        if (typeof trapFocus === 'function') trapFocus(modal);
        setTimeout(() => document.getElementById('editReviewTitle')?.focus(), 120);
      } catch (e) { console.error(e); showToast('Could not open edit dialog.', 'error'); }
    }

    function closeEditReview() {
      const modal = document.getElementById('editReviewModal');
      if (!modal) return;
      modal.classList.remove('show'); modal.setAttribute('aria-hidden','true');
      if (typeof releaseFocus === 'function') releaseFocus();
    }

    function saveEditedReview(e) {
      if (e && e.preventDefault) e.preventDefault();
      try {
        const id = Number(document.getElementById('editReviewId').value);
        const title = document.getElementById('editReviewTitle').value.trim();
        const text = document.getElementById('editReviewText').value.trim();
        const rating = Number(document.querySelector('#editReviewModal input[name="edit-rating"]:checked')?.value || 0);
        if (!title || !text) { showToast('Title and review text are required.', 'error'); return; }
        if (!rating || rating < 1) { showToast('Please provide a rating.', 'error'); return; }

        const reviews = JSON.parse(localStorage.getItem('lcd_reviews') || '[]');
        const idx = reviews.findIndex(r => r.id === id);
        if (idx === -1) { showToast('Review not found.', 'error'); return; }

        // Author check: prefer authorId equality, fallback to legacy author string
        const user = getCurrentUser();
        if (!user) { showToast('You must be logged in to edit your review.', 'error'); return; }
        if (reviews[idx].authorId) {
          if (reviews[idx].authorId !== user.id) { showToast('You can only edit your own reviews.', 'error'); return; }
        } else {
          const author = (reviews[idx].author || '').toLowerCase();
          const uname = (user.name || '').toLowerCase();
          const uemail = (user.email || '').toLowerCase();
          if (!(author === uname || author === uemail)) { showToast('You can only edit your own reviews.', 'error'); return; }
          // migrate to authorId
          try { reviews[idx].authorId = user.id; } catch(e){}
        }

        reviews[idx].title = title;
        reviews[idx].text = text;
        reviews[idx].rating = rating;
        reviews[idx].edited_at = new Date().toISOString();
        localStorage.setItem('lcd_reviews', JSON.stringify(reviews));
        renderReviews();
        updateReviewsJsonLd(reviews);
        closeEditReview();
        showToast('Review updated.', 'success');
      } catch (e) { console.error(e); showToast('Could not save review.', 'error'); }
    }

    // Ensure images use lazy loading across the page
    (function ensureLazyImages(){
      document.querySelectorAll('img').forEach(img => {
        if (!img.hasAttribute('loading')) img.setAttribute('loading','lazy');
        // If you produce WebP images in your build, consider adding a <picture> element with WebP source for best compression.
      });
    })();

    function escapeHtml(s) {
      if (!s) return '';
      return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
    }

    function quickBook() {
      const checkin = document.getElementById('quickCheckin').value;
      const nights = parseInt(document.getElementById('quickNights').value || '1', 10);
      if (!checkin || nights < 1) {
        showToast('Please choose a check-in date and number of nights.', 'error');
        return;
      }
      document.getElementById('checkin').value = checkin;
      const ci = new Date(checkin);
      const co = new Date(ci);
      co.setDate(ci.getDate() + nights);
      document.getElementById('checkout').valueAsDate = co;
      initBookingDates(); recalcSummary();
      showView('booking');

      // Save recent room viewed
      try {
        const recent = JSON.parse(localStorage.getItem('lcd_recent_rooms') || '[]');
        const sel = sessionStorage.getItem('lcd_selected_room') || 'room1';
        if (!recent.includes(sel)) { recent.unshift(sel); if (recent.length>5) recent.length=5; localStorage.setItem('lcd_recent_rooms', JSON.stringify(recent)); }
      } catch(e){}
    }

    setInterval(() => {
      const images = document.querySelectorAll('#carousel-slide-container .carousel-image');
      if (!images.length) return;
      let idx = Array.from(images).findIndex(img => img.classList.contains('active'));
      idx = (idx + 1) % images.length;
      setActiveCarousel(idx);
    }, 4000);
  </script>

    <!-- Calendar Feature Start -->
<div id="calendarModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="modal-card card" style="position:relative; max-width:700px;">
    <button class="modal-close" aria-label="Close" onclick="closeCalendar()">
      <span>&times;</span>
    </button>
    <h3 style="margin-top:0; font-family:'Playfair Display', serif;">Select Your Dates</h3>
    <div id="calendarContainer"></div>
    <div style="text-align:right; margin-top:20px;">
      <button class="btn primary" id="confirmDatesBtn">Confirm Dates</button>
    </div>
    <p class="muted" style="font-size:0.9em; margin-top:10px;">
      Booked dates shown in <span style="color:#8B7D6C; opacity:0.6; font-weight:700;">brown</span>.
    </p>
  </div>
</div>
<!-- Calendar Feature End -->

<!-- Booking Confirmation Modal -->
<!-- Edit Review Modal -->
<div id="editReviewModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="modal-card card" style="position:relative; max-width:640px;">
    <button class="modal-close" aria-label="Close" onclick="closeEditReview()"><i class="fas fa-times"></i></button>
    <h3 style="margin-top:0; font-family:'Playfair Display', serif;">Edit Your Review</h3>
    <form id="editReviewForm" onsubmit="saveEditedReview(event)">
      <input type="hidden" id="editReviewId" value="">
      <div class="form-group">
        <label for="editReviewTitle">Title</label>
        <input type="text" id="editReviewTitle" required placeholder="Short title for your review">
      </div>
      <div class="form-group">
        <label for="editReviewText">Review</label>
        <textarea id="editReviewText" rows="6" required placeholder="Update your review text..."></textarea>
      </div>
      <div class="form-group" style="text-align:center;">
        <label style="display:block; margin-bottom:8px;">Rating</label>
        <div class="rating" role="radiogroup" aria-label="Edit rating (1-5)">
          <input type="radio" name="edit-rating" id="edit-star5" value="5"><label for="edit-star5" title="5 stars"><i class="fa fa-star" aria-hidden="true"></i></label>
          <input type="radio" name="edit-rating" id="edit-star4" value="4"><label for="edit-star4" title="4 stars"><i class="fa fa-star" aria-hidden="true"></i></label>
          <input type="radio" name="edit-rating" id="edit-star3" value="3"><label for="edit-star3" title="3 stars"><i class="fa fa-star" aria-hidden="true"></i></label>
          <input type="radio" name="edit-rating" id="edit-star2" value="2"><label for="edit-star2" title="2 stars"><i class="fa fa-star" aria-hidden="true"></i></label>
          <input type="radio" name="edit-rating" id="edit-star1" value="1"><label for="edit-star1" title="1 star"><i class="fa fa-star" aria-hidden="true"></i></label>
        </div>
      </div>
      <div style="display:flex; gap:12px; margin-top:12px;">
        <button type="submit" class="btn primary" style="flex:1;">Save Changes</button>
        <button type="button" class="btn google-btn" onclick="closeEditReview()">Cancel</button>
      </div>
    </form>
  </div>
</div>
<div id="bookingConfirmModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="modal-card card" style="position:relative; max-width:580px;">
    <button class="modal-close" aria-label="Close" onclick="closeBookingConfirm()">
      <span>&times;</span>
    </button>
    <h3 style="margin-top:0; font-family:'Playfair Display', serif;">Confirm Your Booking</h3>
    <div style="margin-top:15px;">
      <h4 style="font-family:'Playfair Display',serif; margin:0 0 12px;">Booking Details</h4>
      <div class="booking-confirm-details" style="display:grid; gap:8px; padding:15px; background:var(--accent-light); border-radius:12px;">
        <p style="margin:0;"><strong>Room:</strong> <span id="confirm-room"></span></p>
        <p style="margin:0;"><strong>Guest Name:</strong> <span id="confirm-name"></span></p>
        <p style="margin:0;"><strong>Email:</strong> <span id="confirm-email"></span></p>
        <p style="margin:0;"><strong>Check-in:</strong> <span id="confirm-checkin"></span></p>
        <p style="margin:0;"><strong>Check-out:</strong> <span id="confirm-checkout"></span></p>
        <p style="margin:0;"><strong>Guests:</strong> <span id="confirm-guests"></span></p>
        <p style="margin:0;"><strong>Airport Pickup:</strong> <span id="confirm-airport"></span></p>
        <p style="margin:0;"><strong>Payment Option:</strong> <span id="confirm-payment"></span></p>
        <p style="margin:0; font-size:1.1em;"><strong>Total Amount:</strong> <span id="confirm-total" class="accent" style="font-weight:700;"></span></p>
        <p style="margin:4px 0 0; font-size:1.1em;"><strong>Due Today:</strong> <span id="confirm-deposit" class="accent" style="font-weight:700;"></span></p>
      </div>
    </div>
    <div style="display:flex; gap:12px; margin-top:20px;">
      <button class="btn primary" style="flex:1;" onclick="proceedWithBooking()">Confirm & Continue</button>
      <button class="btn google-btn" onclick="closeBookingConfirm()">Edit Details</button>
    </div>
    <p class="muted" style="font-size:0.9em; margin:12px 0 0;">Next step: Login or sign up to complete your booking.</p>
  </div>
</div><!-- Calendar Script -->
<script src="calendar.js" defer></script>

<script>
window.addEventListener("load", () => {
  const bookingForm = document.getElementById("bookingForm");

  if (!bookingForm) {
    console.error("⚠️ Booking form not found in DOM!");
    return;
  }

  console.log("✅ Booking form found and ready.");

  bookingForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    console.log("📤 Sending booking...");

    const formData = {
      roomCode: document.getElementById("selected-room").textContent.trim(),
      name: document.getElementById("name").value.trim(),
      email: document.getElementById("email").value.trim(),
      guests: document.getElementById("guests").value,
      checkin: document.getElementById("checkin").value,
      checkout: document.getElementById("checkout").value,
      airportPickup: document.getElementById("airport").checked,
      fullPayment: document.getElementById("fullPayment").checked
    };

    try {
      const response = await fetch("http://localhost:5000/api/bookings", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formData)
      });

      const data = await response.json();

      if (response.ok) {
        alert("✅ Booking successfully saved!");
        console.log("✅ Server response:", data);
        bookingForm.reset();
        window.scrollTo({ top: 0, behavior: "smooth" });
      } else {
        alert("❌ Booking failed: " + (data.error || "Unknown error"));
        console.error("Server error:", data);
      }
    } catch (error) {
      console.error("⚠️ Could not connect to server:", error);
      alert("⚠️ Could not connect to server. Make sure backend is running.");
    }
  });
});
</script>

</body>
</html>
